function Ps(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var J;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(J||(J={}));class re extends Error{constructor(s,t,r){super(s),this.message=s,this.code=t,this.data=r}}const Re=e=>{var s,t;return e!=null&&e.androidBridge?"android":!((t=(s=e==null?void 0:e.webkit)===null||s===void 0?void 0:s.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},ze=e=>{const s=e.CapacitorCustomPlatform||null,t=e.Capacitor||{},r=t.Plugins=t.Plugins||{},a=()=>s!==null?s.name:Re(e),i=()=>a()!=="web",n=d=>{const c=b.get(d);return!!(c!=null&&c.platforms.has(a())||o(d))},o=d=>{var c;return(c=t.PluginHeaders)===null||c===void 0?void 0:c.find(m=>m.name===d)},u=d=>e.console.error(d),b=new Map,g=(d,c={})=>{const m=b.get(d);if(m)return console.warn('Capacitor plugin "'.concat(d,'" already registered. Cannot register plugins twice.')),m.proxy;const p=a(),y=o(d);let x;const N=async()=>(!x&&p in c?x=typeof c[p]=="function"?x=await c[p]():x=c[p]:s!==null&&!x&&"web"in c&&(x=typeof c.web=="function"?x=await c.web():x=c.web),x),E=(I,f)=>{var h,_;if(y){const C=y==null?void 0:y.methods.find(D=>f===D.name);if(C)return C.rtype==="promise"?D=>t.nativePromise(d,f.toString(),D):(D,O)=>t.nativeCallback(d,f.toString(),D,O);if(I)return(h=I[f])===null||h===void 0?void 0:h.bind(I)}else{if(I)return(_=I[f])===null||_===void 0?void 0:_.bind(I);throw new re('"'.concat(d,'" plugin is not implemented on ').concat(p),J.Unimplemented)}},U=I=>{let f;const h=(..._)=>{const C=N().then(D=>{const O=E(D,I);if(O){const z=O(..._);return f=z==null?void 0:z.remove,z}else throw new re('"'.concat(d,".").concat(I,'()" is not implemented on ').concat(p),J.Unimplemented)});return I==="addListener"&&(C.remove=async()=>f()),C};return h.toString=()=>"".concat(I.toString(),"() { [capacitor code] }"),Object.defineProperty(h,"name",{value:I,writable:!1,configurable:!1}),h},q=U("addListener"),j=U("removeListener"),H=(I,f)=>{const h=q({eventName:I},f),_=async()=>{const D=await h;j({eventName:I,callbackId:D},f)},C=new Promise(D=>h.then(()=>D({remove:_})));return C.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await _()},C},B=new Proxy({},{get(I,f){switch(f){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return y?H:q;case"removeListener":return j;default:return U(f)}}});return r[d]=B,b.set(d,{name:d,proxy:B,platforms:new Set([...Object.keys(c),...y?[p]:[]])}),B};return t.convertFileSrc||(t.convertFileSrc=d=>d),t.getPlatform=a,t.handleError=u,t.isNativePlatform=i,t.isPluginAvailable=n,t.registerPlugin=g,t.Exception=re,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},We=e=>e.Capacitor=ze(e),Y=We(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),te=Y.registerPlugin;class Ee{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(s,t){let r=!1;this.listeners[s]||(this.listeners[s]=[],r=!0),this.listeners[s].push(t);const i=this.windowListeners[s];i&&!i.registered&&this.addWindowListener(i),r&&this.sendRetainedArgumentsForEvent(s);const n=async()=>this.removeListener(s,t);return Promise.resolve({remove:n})}async removeAllListeners(){this.listeners={};for(const s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,t,r){const a=this.listeners[s];if(!a){if(r){let i=this.retainedEventArguments[s];i||(i=[]),i.push(t),this.retainedEventArguments[s]=i}return}a.forEach(i=>i(t))}hasListeners(s){var t;return!!(!((t=this.listeners[s])===null||t===void 0)&&t.length)}registerWindowListener(s,t){this.windowListeners[t]={registered:!1,windowEventName:s,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(s="not implemented"){return new Y.Exception(s,J.Unimplemented)}unavailable(s="not available"){return new Y.Exception(s,J.Unavailable)}async removeListener(s,t){const r=this.listeners[s];if(!r)return;const a=r.indexOf(t);this.listeners[s].splice(a,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}sendRetainedArgumentsForEvent(s){const t=this.retainedEventArguments[s];t&&(delete this.retainedEventArguments[s],t.forEach(r=>{this.notifyListeners(s,r)}))}}const be=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),pe=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ge extends Ee{async getCookies(){const s=document.cookie,t={};return s.split(";").forEach(r=>{if(r.length<=0)return;let[a,i]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=pe(a).trim(),i=pe(i).trim(),t[a]=i}),t}async setCookie(s){try{const t=be(s.key),r=be(s.value),a="; expires=".concat((s.expires||"").replace("expires=","")),i=(s.path||"/").replace("path=",""),n=s.url!=null&&s.url.length>0?"domain=".concat(s.url):"";document.cookie="".concat(t,"=").concat(r||"").concat(a,"; path=").concat(i,"; ").concat(n,";")}catch(t){return Promise.reject(t)}}async deleteCookie(s){try{document.cookie="".concat(s.key,"=; Max-Age=0")}catch(t){return Promise.reject(t)}}async clearCookies(){try{const s=document.cookie.split(";")||[];for(const t of s)document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires=".concat(new Date().toUTCString(),";path=/"))}catch(s){return Promise.reject(s)}}async clearAllCookies(){try{await this.clearCookies()}catch(s){return Promise.reject(s)}}}te("CapacitorCookies",{web:()=>new Ge});const Ve=async e=>new Promise((s,t)=>{const r=new FileReader;r.onload=()=>{const a=r.result;s(a.indexOf(",")>=0?a.split(",")[1]:a)},r.onerror=a=>t(a),r.readAsDataURL(e)}),Ke=(e={})=>{const s=Object.keys(e);return Object.keys(e).map(a=>a.toLocaleLowerCase()).reduce((a,i,n)=>(a[i]=e[s[n]],a),{})},Je=(e,s=!0)=>e?Object.entries(e).reduce((r,a)=>{const[i,n]=a;let o,u;return Array.isArray(n)?(u="",n.forEach(b=>{o=s?encodeURIComponent(b):b,u+="".concat(i,"=").concat(o,"&")}),u.slice(0,-1)):(o=s?encodeURIComponent(n):n,u="".concat(i,"=").concat(o)),"".concat(r,"&").concat(u)},"").substr(1):null,Ye=(e,s={})=>{const t=Object.assign({method:e.method||"GET",headers:e.headers},s),a=Ke(e.headers)["content-type"]||"";if(typeof e.data=="string")t.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[n,o]of Object.entries(e.data||{}))i.set(n,o);t.body=i.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const i=new FormData;if(e.data instanceof FormData)e.data.forEach((o,u)=>{i.append(u,o)});else for(const o of Object.keys(e.data))i.append(o,e.data[o]);t.body=i;const n=new Headers(t.headers);n.delete("content-type"),t.headers=n}else(a.includes("application/json")||typeof e.data=="object")&&(t.body=JSON.stringify(e.data));return t};class Ze extends Ee{async request(s){const t=Ye(s,s.webFetchExtra),r=Je(s.params,s.shouldEncodeUrlParams),a=r?"".concat(s.url,"?").concat(r):s.url,i=await fetch(a,t),n=i.headers.get("content-type")||"";let{responseType:o="text"}=i.ok?s:{};n.includes("application/json")&&(o="json");let u,b;switch(o){case"arraybuffer":case"blob":b=await i.blob(),u=await Ve(b);break;case"json":u=await i.json();break;case"document":case"text":default:u=await i.text()}const g={};return i.headers.forEach((d,c)=>{g[c]=d}),{data:u,headers:g,status:i.status,url:i.url}}async get(s){return this.request(Object.assign(Object.assign({},s),{method:"GET"}))}async post(s){return this.request(Object.assign(Object.assign({},s),{method:"POST"}))}async put(s){return this.request(Object.assign(Object.assign({},s),{method:"PUT"}))}async patch(s){return this.request(Object.assign(Object.assign({},s),{method:"PATCH"}))}async delete(s){return this.request(Object.assign(Object.assign({},s),{method:"DELETE"}))}}te("CapacitorHttp",{web:()=>new Ze});const w={backendUrl:Y.isNativePlatform()?"https://personal-time-manager.onrender.com":window.location.hostname==="127.0.0.1"||window.location.hostname==="localhost"||window.location.hostname==="0.0.0.0"?"http://127.0.0.1:8000":"https://personal-time-manager.onrender.com",subjects:["Math","Physics","Chemistry","Biology","IT"],noteSubjects:["Math","Physics","Chemistry","Biology","IT","Geography"],noteTypes:["STUDY_NOTES","HOMEWORK","PAST_PAPERS"],educationalSystems:["IGCSE","SAT","National-EG","National-KW"],colors:{school:"var(--school-color)",sports:"var(--sports-color)",others:"var(--others-color)",tuition:"var(--tuition-color)",sleep:"var(--sleep-color)"},defaultSchoolTimes:{start:"06:00",end:"15:00"},defaultSleepTimes:{start:"22:00",end:"05:00"},daysOfWeek:["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"],timeSlotsStartHour:5,pixelsPerMinute:1,version:"v0.2"};let l={currentUser:null,students:[],currentStudent:null,currentPage:"login",currentTimetableDay:new Date().getDay()+1>6?0:new Date().getDay()+1,isSidebarOpen:!1,teacherTuitionLogs:[],notes:[],allStudents:[],notesStudentFilter:null};function A(e,s,t,r){P();const a=document.getElementById("modal-container"),i=document.createElement("div");i.id="modal-backdrop",i.className="modal-backdrop",i.innerHTML='\n        <div class="modal-content">\n            <div class="modal-header flex justify-between items-center mb-4">\n                <h3 class="text-xl font-semibold">'.concat(e,'</h3>\n                <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-700 -mr-2 -mt-2"><i class="fas fa-times"></i></button>\n            </div>\n            <div class="modal-body">').concat(s,'</div>\n            <div class="modal-footer mt-4">').concat(t,"</div>\n        </div>"),a.appendChild(i),r&&r(i)}function ce(e,s,t,r){const a=document.getElementById("modal-container"),i=document.createElement("div");i.className="modal-backdrop",i.style.zIndex="110",i.innerHTML='\n        <div class="modal-content">\n            <div class="modal-header flex justify-between items-center mb-4">\n                <h3 class="text-xl font-semibold">'.concat(e,'</h3>\n                <button class="dialog-close-btn p-2 rounded-full hover:bg-gray-700 -mr-2 -mt-2"><i class="fas fa-times"></i></button>\n            </div>\n            <div class="modal-body">').concat(s,'</div>\n            <div class="modal-footer mt-4">').concat(t,"</div>\n        </div>"),i.querySelector(".dialog-close-btn").addEventListener("click",()=>G(i)),a.appendChild(i),r&&r(i)}function Qe(e,s){A(e,s,'<div class="flex justify-end"><button id="modal-close-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">OK</button></div>')}function X(e,s,t){const r="<p>".concat(s,"</p>");A(e,r,'\n        <div class="flex justify-end space-x-4">\n            <button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button>\n            <button id="modal-confirm-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-md">Confirm</button>\n        </div>',i=>{i.querySelector("#modal-confirm-btn").addEventListener("click",()=>{P(),t()}),i.querySelector("#modal-cancel-btn").addEventListener("click",()=>P())})}function P(){var e;(e=document.getElementById("modal-backdrop"))==null||e.remove()}function G(e){e&&e.remove()}const ue=document.getElementById("status-overlay-container");function $(e){ue.innerHTML='<div id="status-overlay"><div class="loader"></div><p>'.concat(e,"</p></div>")}function v(e,s){const t=e==="success"?'<i class="fas fa-check-circle text-5xl text-green-500"></i>':'<i class="fas fa-times-circle text-5xl text-red-500"></i>';ue.innerHTML='<div id="status-overlay">'.concat(t,"<p>").concat(s,"</p></div>"),setTimeout(k,2e3)}function k(){ue.innerHTML=""}function R(e,s="error"){const t=document.getElementById("auth-feedback");if(!t)return;const r=s==="success"?"text-green-400":"text-red-400";t.innerHTML='<p class="'.concat(r,' text-sm font-medium">').concat(e,"</p>")}function je(){const e=document.getElementById("auth-feedback");e&&(e.innerHTML="")}function me(){l.isSidebarOpen=!l.isSidebarOpen,document.getElementById("sidebar").classList.toggle("open")}function Xe(){const e=document.getElementById("sidebar");window.innerWidth>=768?(e.classList.add("open"),l.isSidebarOpen=!0):(e.classList.remove("open"),l.isSidebarOpen=!1)}function Te(e){document.getElementById("page-title").textContent="Error",document.getElementById("page-content").innerHTML='\n        <div class="text-center p-8 bg-gray-800 rounded-lg">\n            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>\n            <h3 class="text-xl font-semibold text-red-400">Application Error</h3>\n            <p class="text-gray-400 mt-2">'.concat(e,'</p>\n            <p class="text-xs text-gray-500 mt-4">This could be a temporary issue with the backend server or your network connection. Please try refreshing the page.</p>\n            <button id="retry-connection-btn" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Retry Connection</button>\n        </div>')}function et(){var s;if(((s=l.currentUser)==null?void 0:s.role)!=="parent"||l.students.length<=1)return"";const e=l.students.map(t=>'<option value="'.concat(t.id,'" ').concat(l.currentStudent&&l.currentStudent.id===t.id?"selected":"",">").concat(t.firstName," ").concat(t.lastName,"</option>")).join("");return'<div class="mb-4"><label for="student-selector" class="text-sm text-gray-400">Viewing Timetable for:</label><select id="student-selector" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">'.concat(e,"</select></div>")}function tt(e,s,t,r){const a=t/w.pixelsPerMinute+w.timeSlotsStartHour*60,i=Math.floor(a/60)%24,n=Math.floor(a%60/15)*15,o="".concat(String(i).padStart(2,"0"),":").concat(String(n).padStart(2,"0")),u='<div class="space-y-4"><div><label class="text-sm text-gray-400">Activity Type</label><select id="add-event-type" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"><option value="sports">Sports Activity</option><option value="others">Others</option></select></div><div class="grid grid-cols-2 gap-4"><div><label class="text-sm text-gray-400">Start Time</label><input type="time" id="add-event-start" value="'.concat(o,'" step="900" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div><div><label class="text-sm text-gray-400">End Time</label><input type="time" id="add-event-end" value="').concat(o,'" step="900" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div></div></div>');ce("Add Activity",u,'<div class="flex justify-end space-x-4"><button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button><button id="modal-confirm-add-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Add</button></div>',g=>{g.addEventListener("click",d=>{if(d.target.closest("#modal-cancel-btn")&&G(g),d.target.closest("#modal-confirm-add-btn")){const c=g.querySelector("#add-event-type").value,m=g.querySelector("#add-event-start").value,p=g.querySelector("#add-event-end").value;m&&p?(e.availability[s].push({type:c,start:m,end:p}),r(),G(g)):alert("Please set start and end times.")}})})}function st(e,s,t,r){const a=e.availability[s],i=a.findIndex(b=>b.start===t);if(i===-1)return;const n=a[i],o='<div class="grid grid-cols-2 gap-4"><div><label class="text-sm text-gray-400">Start Time</label><input type="time" id="edit-event-start" value="'.concat(n.start,'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div><div><label class="text-sm text-gray-400">End Time</label><input type="time" id="edit-event-end" value="').concat(n.end,'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div></div><button id="delete-event-btn" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">Delete Event</button>');ce("Edit ".concat(n.type," Activity"),o,'<div class="flex justify-end space-x-4"><button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button><button id="modal-confirm-edit-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Save Changes</button></div>',b=>{b.addEventListener("click",g=>{const d=g.target.closest("button");if(d)if(d.id==="modal-cancel-btn")G(b);else if(d.id==="modal-confirm-edit-btn"){const c=b.querySelector("#edit-event-start").value,m=b.querySelector("#edit-event-end").value;a[i]={...n,start:c,end:m},r(),G(b)}else d.id==="delete-event-btn"&&(a.splice(i,1),r(),G(b))})})}function nt(e,s,t){const r=s==="school"?w.defaultSchoolTimes:w.defaultSleepTimes,a='<div class="grid grid-cols-2 gap-4"><div><label class="text-sm text-gray-400">Start Time</label><input type="time" id="set-all-start" value="'.concat(r.start,'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div><div><label class="text-sm text-gray-400">End Time</label><input type="time" id="set-all-end" value="').concat(r.end,'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div></div>');ce("Set All ".concat(s.charAt(0).toUpperCase()+s.slice(1)," Times"),a,'<div class="flex justify-end space-x-4"><button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button><button id="modal-confirm-set-all-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Apply to All Days</button></div>',n=>{n.addEventListener("click",o=>{if(o.target.closest("#modal-cancel-btn")&&G(n),o.target.closest("#modal-confirm-set-all-btn")){const u=n.querySelector("#set-all-start").value,b=n.querySelector("#set-all-end").value;(s==="school"?["Sunday","Monday","Tuesday","Wednesday","Thursday"]:w.daysOfWeek).forEach(c=>{const m=c.toLowerCase(),p=e.availability[m].findIndex(y=>y.type===s);p>-1?(e.availability[m][p].start=u,e.availability[m][p].end=b):e.availability[m].push({type:s,start:u,end:b})}),t(),G(n)}})})}function Z(e,s,t=[]){const r=w.daysOfWeek[l.currentTimetableDay].toLowerCase(),a=s.availability?s.availability[r]||[]:[],i=e?[]:t.filter(d=>d.day===r);let n="";for(let d=w.timeSlotsStartHour;d<24+w.timeSlotsStartHour;d++){const c=d%24;let m=c%12;m===0&&(m=12),n+='<div class="time-label text-right pr-2 text-xs text-gray-500 border-t border-gray-700 flex items-center justify-end">'.concat(m," ").concat(c>=12?"PM":"AM","</div>")}const o=d=>{if(!d)return 0;const[c,m]=d.split(":").map(Number);let p=c*60+m;return c<w.timeSlotsStartHour&&(p+=1440),(p-w.timeSlotsStartHour*60)*w.pixelsPerMinute},u=(d,c,m)=>{if(m<=0)return"";const p=!!d.subject,y=p?"tuition":d.type,x=w.colors[y]||w.colors.others,N=p?d.subject:d.type,E=y!=="tuition"&&e?"cursor-pointer":"";return'<div class="event-bubble '.concat(E,' hover:opacity-80" style="background-color: ').concat(x,"; top: ").concat(c,"px; height: ").concat(m,'px;" data-type="').concat(y,'" data-start="').concat(d.start,'" data-end="').concat(d.end,'">\n                    <p class="font-bold capitalize">').concat(N,"</p>\n                    <p>").concat(d.start," - ").concat(d.end,"</p>\n                </div>")},b=[...a,...i].map(d=>{if(!d.start||!d.end)return"";const c=o(d.start),m=o(d.end);if(m<c){const y=1440*w.pixelsPerMinute-c,x=m;return u(d,c,y)+u(d,0,x)}return u(d,c,m-c)}).join(""),g=e?'\n        <div class="flex space-x-2 mb-4">\n            <button class="set-all-times-btn flex-1 text-sm bg-gray-600 hover:bg-gray-500 rounded-md py-2" data-type="school"><i class="fas fa-school mr-2"></i> Set All School Times</button>\n            <button class="set-all-times-btn flex-1 text-sm bg-gray-600 hover:bg-gray-500 rounded-md py-2" data-type="sleep"><i class="fas fa-bed mr-2"></i> Set All Sleep Times</button>\n        </div>':"";return'\n        <div class="timetable-component">\n            '.concat(g,"\n            ").concat(e?"":et(),'\n            <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg mb-4">\n                <button class="day-nav-btn p-2 rounded-md hover:bg-gray-700" data-direction="-1"><i class="fas fa-chevron-left"></i></button>\n                <h3 class="text-xl font-semibold">').concat(w.daysOfWeek[l.currentTimetableDay],'</h3>\n                <button class="day-nav-btn p-2 rounded-md hover:bg-gray-700" data-direction="1"><i class="fas fa-chevron-right"></i></button>\n            </div>\n            <div class="flex">\n                <div class="w-16 flex-shrink-0">').concat(n,'</div>\n                <div class="timetable-grid flex-grow bg-gray-800/50 rounded-lg" id="timetable-grid-main" data-day-key="').concat(r,'">\n                    ').concat(b,"\n                </div>\n            </div>\n        </div>")}async function at(){var s,t,r;if(((s=l.currentUser)==null?void 0:s.role)==="teacher")return'<div class="text-center p-8 text-gray-400">Timetable view is not applicable for teachers. Please use the "Tuition Logs" and "Payment Logs" pages.</div>';if(!(l.currentUser.role==="student"?l.currentUser.id:(t=l.currentStudent)==null?void 0:t.id))return((r=l.currentUser)==null?void 0:r.role)==="parent"?"<div class=\"text-center p-8 text-gray-400\">No student selected. Please add or select a student from the 'Student Info' page.</div>":'<div class="text-center p-8 text-gray-400">Loading timetable...</div>';try{const a=await Ce(),i=l.currentUser.role==="parent"?l.currentStudent:l.currentUser,n=l.currentUser.role==="parent"?a.filter(o=>o.student_id===l.currentStudent.id):a;return Z(!1,i,n)}catch(a){return console.error("Error fetching timetable:",a),'<div class="text-center text-red-400 p-8">Error loading timetable: '.concat(a.message,"</div>")}}const K={showAddEventModal:tt,showEditEventModal:st,showSetAllTimesModal:nt};let L=null;function it(e){const s={};return w.daysOfWeek.forEach(t=>{s[t.toLowerCase()]=[]}),e&&e.forEach(t=>{var a;const r=(a=w.daysOfWeek[t.day_of_week-1])==null?void 0:a.toLowerCase();r&&s[r].push({type:t.availability_type,start:t.start_time.slice(0,5),end:t.end_time.slice(0,5)})}),s}function Pe(e){const s=[];return w.daysOfWeek.forEach((t,r)=>{const a=t.toLowerCase();(e[a]||[]).forEach(n=>{s.push({day_of_week:r+1,start_time:n.start.length===5?"".concat(n.start,":00"):n.start,end_time:n.end.length===5?"".concat(n.end,":00"):n.end,availability_type:n.type})})}),s}async function rt(){var s;const e=(s=l.currentUser)==null?void 0:s.role;if(!e)return'<div class="text-center p-8 text-red-400">User role not found.</div>';try{if($("Loading Profile..."),e==="teacher"){const t=await ot();return k(),t}else if(e==="parent"){const t=await dt();return k(),t}else if(e==="student"){const t=await V(l.currentUser.id,"view");return k(),t}else return k(),'<div class="text-center p-8 text-gray-400">Profile editing for <strong>'.concat(e,"</strong> is coming soon.</div>")}catch(t){return k(),console.error("Error rendering profile:",t),'<div class="text-center text-red-400 p-8">Error loading profile: '.concat(t.message,"</div>")}}async function ot(e=(s=>(s=l.currentUser)==null?void 0:s.id)()){const[t,r,a,i]=await Promise.all([Me(e),He(e),Ue(),qe()]),n=a.map(d=>'<option value="'.concat(d,'" ').concat(t.timezone===d?"selected":"",">").concat(d,"</option>")).join(""),o=i.map(d=>'<option value="'.concat(d,'" ').concat(t.currency===d?"selected":"",">").concat(d,"</option>")).join(""),u='\n        <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-6">\n            <h3 class="text-xl font-semibold mb-4 text-indigo-300">Personal Information</h3>\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">First Name</label>\n                    <input type="text" id="profile-first-name" value="'.concat(t.first_name||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Last Name</label>\n                    <input type="text" id="profile-last-name" value="').concat(t.last_name||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Email</label>\n                    <input type="email" id="profile-email" value="').concat(t.email||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Timezone</label>\n                    <select id="profile-timezone" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                        <option value="">Select Timezone</option>\n                        ').concat(n,'\n                    </select>\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Currency</label>\n                    <select id="profile-currency" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                        <option value="">Select Currency</option>\n                        ').concat(o,'\n                    </select>\n                </div>\n                 <div>\n                    <label class="block text-sm font-medium text-gray-400">Password</label>\n                    <input type="password" disabled placeholder="Change Password coming soon..." class="w-full mt-1 p-2 bg-gray-900 text-gray-500 rounded-md border border-gray-800 cursor-not-allowed">\n                </div>\n            </div>\n            <div class="mt-6 text-right">\n                <button id="save-teacher-profile-btn" data-user-id="').concat(e,'" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md transition duration-300">\n                    Save Changes\n                </button>\n            </div>\n        </div>\n    '),b=r.length>0?r.map(d=>'\n            <div class="flex justify-between items-center bg-gray-700 p-3 rounded-md mb-2 border border-gray-600">\n                <div>\n                    <span class="font-bold text-indigo-300">'.concat(d.subject,'</span> \n                    <span class="text-sm text-gray-300 mx-2">•</span>\n                    <span class="text-sm text-gray-300">').concat(d.educational_system,'</span>\n                    <span class="text-sm text-gray-300 mx-2">•</span>\n                    <span class="text-sm text-gray-300">Grade ').concat(d.grade,'</span>\n                </div>\n                <button class="delete-specialty-btn text-red-400 hover:text-red-300 p-2 rounded hover:bg-gray-600" data-id="').concat(d.id,'" data-teacher-id="').concat(e,'">\n                    <i class="fas fa-trash"></i>\n                </button>\n            </div>\n        ')).join(""):'<p class="text-gray-400 text-center py-4">No specialties added yet.</p>',g='\n        <div class="bg-gray-800 p-6 rounded-lg shadow-md">\n            <div class="flex justify-between items-center mb-4">\n                <h3 class="text-xl font-semibold text-indigo-300">Specialties</h3>\n                <button id="open-add-specialty-modal-btn" data-user-id="'.concat(e,'" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-md">\n                    <i class="fas fa-plus mr-2"></i> Add Specialty\n                </button>\n            </div>\n            <div class="specialties-list-container">\n                ').concat(b,"\n            </div>\n        </div>\n    ");return'\n        <div class="max-w-4xl mx-auto">\n            <h2 class="text-2xl font-bold mb-6">Teacher Profile</h2>\n            '.concat(u,"\n            ").concat(g,"\n        </div>\n    ")}async function dt(e=(s=>(s=l.currentUser)==null?void 0:s.id)()){const[t,r,a]=await Promise.all([ds(e),Ue(),qe()]),i=r.map(o=>'<option value="'.concat(o,'" ').concat(t.timezone===o?"selected":"",">").concat(o,"</option>")).join(""),n=a.map(o=>'<option value="'.concat(o,'" ').concat(t.currency===o?"selected":"",">").concat(o,"</option>")).join("");return'\n        <div class="max-w-3xl mx-auto">\n            <h2 class="text-2xl font-bold mb-6">Parent Profile</h2>\n            <div class="bg-gray-800 p-6 rounded-lg shadow-md">\n                <h3 class="text-xl font-semibold mb-4 text-indigo-300">Personal Information</h3>\n                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n                    <div>\n                        <label class="block text-sm font-medium text-gray-400">First Name</label>\n                        <input type="text" id="profile-first-name" value="'.concat(t.first_name||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                    </div>\n                    <div>\n                        <label class="block text-sm font-medium text-gray-400">Last Name</label>\n                        <input type="text" id="profile-last-name" value="').concat(t.last_name||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                    </div>\n                    <div class="md:col-span-2">\n                        <label class="block text-sm font-medium text-gray-400">Email</label>\n                        <input type="email" id="profile-email" value="').concat(t.email||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                    </div>\n                    <div>\n                        <label class="block text-sm font-medium text-gray-400">Timezone</label>\n                        <select id="profile-timezone" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                            <option value="">Select Timezone</option>\n                            ').concat(i,'\n                        </select>\n                    </div>\n                    <div>\n                        <label class="block text-sm font-medium text-gray-400">Currency</label>\n                        <select id="profile-currency" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                            <option value="">Select Currency</option>\n                            ').concat(n,'\n                        </select>\n                    </div>\n                    <div>\n                        <label class="block text-sm font-medium text-gray-400">Password</label>\n                        <input type="password" disabled placeholder="Change Password coming soon..." class="w-full mt-1 p-2 bg-gray-900 text-gray-500 rounded-md border border-gray-800 cursor-not-allowed">\n                    </div>\n                </div>\n                <div class="mt-6 text-right">\n                    <button id="save-parent-profile-btn" data-user-id="').concat(e,'" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md transition duration-300">\n                        Save Changes\n                    </button>\n                </div>\n            </div>\n        </div>\n    ')}async function V(e,s="view"){var q;let t={};const r=(q=l.currentUser)==null?void 0:q.role;if(s!=="create")try{t=await ae(e)}catch(j){return'<div class="text-center text-red-400">Error loading student: '.concat(j.message,"</div>")}if(s==="create"||s==="edit"){if(L={...t,availability:s==="create"?{}:it(t.student_availability_intervals||[]),student_subjects:s==="create"?[]:t.student_subjects||[]},w.daysOfWeek.forEach(j=>{const H=j.toLowerCase();L.availability[H]||(L.availability[H]=[])}),s==="create"){const j=["sunday","monday","tuesday","wednesday","thursday"];w.daysOfWeek.forEach(H=>{const B=H.toLowerCase();L.availability[B].length===0&&(L.availability[B].push({type:"sleep",...w.defaultSleepTimes}),j.includes(B)&&L.availability[B].push({type:"school",...w.defaultSchoolTimes}))})}}else L=null;const a=s==="edit"||s==="create",i=s==="create",n=r==="teacher",o=r==="student",u=(j,H)=>j.map(B=>'<option value="'.concat(B,'" ').concat(B===H?"selected":"",">").concat(B,"</option>")).join(""),b=["NONE","Alpha","Omega","Sigma","HIM"],g=n,d=g?'\n        <div>\n            <label class="block text-sm font-medium text-gray-400">Status</label>\n            <select id="st-status" '.concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                ').concat(u(b,t.status||"NONE"),'\n            </select>\n        </div>\n        <div>\n            <label class="block text-sm font-medium text-gray-400">Hourly Cost (kwd)</label>\n            <input type="number" id="st-cost" value="').concat(t.cost||6,'" step="0.5" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n        </div>\n    '):"",c=g?'\n        <div>\n            <label class="block text-sm font-medium text-gray-400">Min Duration (mins)</label>\n            <input type="number" id="st-min-duration" value="'.concat(t.min_duration_mins||60,'" step="15" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n        </div>\n        <div>\n            <label class="block text-sm font-medium text-gray-400">Max Duration (mins)</label>\n            <input type="number" id="st-max-duration" value="').concat(t.max_duration_mins||90,'" step="15" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n        </div>\n    '):"",m='\n        <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-6">\n            <h3 class="text-xl font-semibold mb-4 text-indigo-300">'.concat(i?"New Student Details":"Student Details",'</h3>\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">First Name</label>\n                    <input type="text" id="st-first-name" value="').concat(t.first_name||"",'" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Last Name</label>\n                    <input type="text" id="st-last-name" value="').concat(t.last_name||"",'" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-400">Grade (1-12)</label>\n                    <input type="number" id="st-grade" value="').concat(t.grade||"",'" min="1" max="12" ').concat(a?"":"disabled",' class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                </div>\n                \n                ').concat(d,'\n\n                 <div>\n                    <label class="block text-sm font-medium text-gray-400">Email</label>\n                    <input type="email" id="st-email" value="').concat(t.email||"",'" ').concat(i?"":"disabled",' placeholder="').concat(i?"Optional (auto-generated if empty)":"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600 ').concat(i?"":"opacity-50 cursor-not-allowed",'">\n                </div>\n                \n                ').concat(c,"\n            </div>\n            \n            ").concat(!i&&!o&&t.generated_password?'\n            <div class="mt-4 p-4 bg-gray-900 rounded-md border border-indigo-900/50">\n                <p class="text-sm text-indigo-300 font-semibold"><i class="fas fa-key mr-2"></i>Generated Credentials</p>\n                <div class="flex items-center justify-between mt-2">\n                    <p class="text-sm text-gray-400">Password: <span class="font-mono text-white select-all">'.concat(t.generated_password,'</span></p>\n                    <p class="text-xs text-gray-500">Share this with the student.</p>\n                </div>\n            </div>'):"","\n\n            ").concat(!i&&a?'\n            <div class="mt-6 text-right">\n                <button id="save-student-details-btn" data-student-id="'.concat(e,'" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md transition duration-300">Save Details</button>\n            </div>'):"","\n        </div>\n    "),p=a?L.student_subjects||[]:t.student_subjects||[],y=p.map(j=>j.teacher_id?Me(j.teacher_id).catch(()=>({first_name:"Unknown",last_name:"Teacher"})):j.teacherObject?Promise.resolve(j.teacherObject):Promise.resolve({first_name:"Pending",last_name:"Save"})),x=await Promise.all(y),N=p.map((j,H)=>{const B=x[H],I="".concat(B.first_name," ").concat(B.last_name);return'\n        <div class="bg-gray-700 p-4 rounded-md border border-gray-600 mb-3 flex justify-between items-start">\n            <div>\n                <h4 class="font-bold text-indigo-300 text-lg">'.concat(j.subject,'</h4>\n                <p class="text-sm text-gray-300">').concat(j.educational_system," • Grade ").concat(j.grade,'</p>\n                <p class="text-sm text-gray-400 mt-1"><i class="fas fa-chalkboard-teacher mr-1"></i> Teacher: <span class="font-semibold text-gray-200">').concat(I,'</span></p>\n                <p class="text-sm text-gray-400">Lessons/Week: ').concat(j.lessons_per_week,"</p>\n            </div>\n            ").concat(a?'<button class="remove-subject-btn text-red-400 hover:text-red-300 p-2" data-student-id="'.concat(e||"new",'" data-subject-index="').concat(H,'"><i class="fas fa-trash"></i></button>'):"","\n        </div>\n    ")}).join(""),E='\n        <div class="bg-gray-800 p-6 rounded-lg shadow-md">\n            <div class="flex justify-between items-center mb-4">\n                <h3 class="text-xl font-semibold text-indigo-300">Enrolled Subjects</h3>\n                '.concat(a?'<button id="add-student-subject-btn" data-student-id="'.concat(e||"new",'" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-md"><i class="fas fa-plus mr-2"></i> Add Subject</button>'):"","\n            </div>\n            ").concat(N||'<p class="text-gray-400 text-center py-4">No subjects enrolled.</p>',"\n        </div>\n    ");let U="";return a&&(U='\n            <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-6">\n                <div class="flex justify-between items-center mb-4">\n                    <h3 class="text-xl font-semibold text-indigo-300">Availability</h3>\n                </div>\n                <div id="profile-timetable-wrapper">\n                    '.concat(Z(!0,L),"\n                </div>\n                ").concat(i?"":'\n                <div class="mt-6 text-right">\n                    <button id="save-student-availability-btn" data-student-id="'.concat(e,'" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md transition duration-300">Save Availability</button>\n                </div>'),"\n            </div>\n        ")),'\n        <div class="max-w-4xl mx-auto space-y-6">\n             '.concat(i?'<button id="cancel-create-student-btn" class="text-gray-400 hover:text-white mb-2"><i class="fas fa-arrow-left mr-2"></i> Back to List</button>':"","\n            ").concat(m,"\n            ").concat(E,"\n            ").concat(U,"\n            ").concat(i?'\n                <div class="bg-gray-800 p-4 rounded-lg shadow-md flex justify-end sticky bottom-4 border-t border-gray-700">\n                    <button id="create-student-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-md transition duration-300 shadow-lg">\n                        Create Student\n                    </button>\n                </div>':"","\n        </div>\n    ")}function Ie(){const e=document.getElementById("profile-timetable-wrapper");e&&L&&(e.innerHTML=Z(!0,L))}function oe(e,...s){if(!L)return;const t=()=>Ie();e==="add"?K.showAddEventModal(L,s[0],s[1],t):e==="edit"?K.showEditEventModal(L,s[0],s[1],t):e==="setAll"&&K.showSetAllTimesModal(L,s[0],t)}async function lt(e){const s=document.getElementById("st-first-name").value.trim(),t=document.getElementById("st-last-name").value.trim(),r=parseInt(document.getElementById("st-grade").value),a=document.getElementById("st-email").value.trim(),i=document.getElementById("st-status"),n=document.getElementById("st-cost"),o=document.getElementById("st-min-duration"),u=document.getElementById("st-max-duration"),b=i?i.value:"NONE",g=n?parseFloat(n.value):6,d=o?parseInt(o.value):60,c=u?parseInt(u.value):90;if(!s||!t||isNaN(r)){v("error","Name and Grade are required.");return}$("Saving Details...");try{const m={first_name:s,last_name:t,grade:r};i&&(m.status=b),n&&(m.cost=g),o&&(m.min_duration_mins=d),u&&(m.max_duration_mins=c),a&&(m.email=a),await ie(e,m),v("success","Details saved successfully.")}catch(m){v("error",m.message)}finally{k()}}async function ct(e){if(L){$("Saving Availability...");try{const t={student_availability_intervals:Pe(L.availability)};await ie(e,t),v("success","Availability saved successfully.")}catch(s){v("error",s.message)}finally{k()}}}async function ut(){const e=document.getElementById("st-first-name").value.trim(),s=document.getElementById("st-last-name").value.trim(),t=parseInt(document.getElementById("st-grade").value),r=document.getElementById("st-status"),a=document.getElementById("st-cost"),i=document.getElementById("st-min-duration"),n=document.getElementById("st-max-duration"),o=r?r.value:"NONE",u=a?parseFloat(a.value):6,b=i?parseInt(i.value):60,g=n?parseInt(n.value):90;if(!e||!s||isNaN(t)){v("error","Name and Grade are required.");return}$("Creating Student...");try{const d=L?Pe(L.availability):[],c=((L==null?void 0:L.student_subjects)||[]).map(p=>({subject:p.subject,teacher_id:p.teacher_id,educational_system:p.educational_system,grade:p.grade,lessons_per_week:p.lessons_per_week,shared_with_student_ids:p.shared_with_student_ids||[]})),m={first_name:e,last_name:s,parent_id:l.currentUser.id,grade:t,status:o,cost:u,min_duration_mins:b,max_duration_mins:g,student_subjects:c,student_availability_intervals:d};await Ne(l.currentUser.id,m),v("success","Student created successfully!"),l.currentUser.role==="parent"&&T()}catch(d){v("error",d.message)}finally{k()}}function mt(e){const s=l.currentUser.role==="teacher",t=w.noteSubjects.map(n=>'<option value="'.concat(n,'">').concat(n,"</option>")).join(""),r=w.educationalSystems.map(n=>'<option value="'.concat(n,'">').concat(n,"</option>")).join(""),a='\n        <div class="space-y-4" id="add-subject-form">\n            <div class="grid grid-cols-2 gap-4">\n                <div>\n                    <label class="text-sm text-gray-400">Subject</label>\n                    <select id="sub-subject" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">'.concat(t,'</select>\n                </div>\n                <div>\n                    <label class="text-sm text-gray-400">System</label>\n                    <select id="sub-system" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(r,'</select>\n                </div>\n            </div>\n            <div>\n                <label class="text-sm text-gray-400">Grade</label>\n                <input type="number" id="sub-grade" min="1" max="12" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" placeholder="Grade">\n            </div>\n            \n            ').concat(s?"":'\n            <div id="teacher-selection-container" class="hidden">\n                <label class="text-sm text-gray-400">Select Teacher</label>\n                <select id="sub-teacher" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></select>\n                <p id="teacher-loading-msg" class="text-xs text-yellow-400 hidden mt-1">Finding teachers...</p>\n            </div>','\n\n            <div>\n                <label class="text-sm text-gray-400">Lessons Per Week</label>\n                <input type="number" id="sub-lessons" min="1" value="1" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n            </div>\n        </div>\n    '),i='\n        <div class="flex justify-end space-x-3">\n            '.concat(s?"":'<button id="find-teachers-btn" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-md">Find Teachers</button>','\n            <button id="save-subject-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-md ').concat(s?"":"hidden",'">Add Subject</button>\n        </div>\n    ');A("Enroll in Subject",a,i,n=>{const o=n.querySelector("#find-teachers-btn"),u=n.querySelector("#save-subject-btn"),b=n.querySelector("#teacher-selection-container"),g=n.querySelector("#sub-teacher");let d=[];o&&o.addEventListener("click",async()=>{const c=n.querySelector("#sub-subject").value,m=n.querySelector("#sub-system").value,p=parseInt(n.querySelector("#sub-grade").value);if(!c||!m||isNaN(p)){alert("Please select Subject, System and Grade.");return}o.disabled=!0,o.textContent="Searching...";try{d=await gs(c,m,p),g.innerHTML="",d.length===0?(alert("No teachers found for this combination."),b.classList.add("hidden")):(d.forEach(y=>{const x=document.createElement("option");x.value=y.id,x.textContent="".concat(y.first_name," ").concat(y.last_name," (").concat(y.email,")"),g.appendChild(x)}),b.classList.remove("hidden"),u.classList.remove("hidden"),o.classList.add("hidden"))}catch(y){alert("Error fetching teachers: "+y.message)}finally{o.disabled=!1,o.textContent="Find Teachers"}}),u.addEventListener("click",async()=>{const c=s?l.currentUser.id:g.value;if(!c){alert("Please select a teacher.");return}if(e==="new"){const p={subject:n.querySelector("#sub-subject").value,educational_system:n.querySelector("#sub-system").value,grade:parseInt(n.querySelector("#sub-grade").value),teacher_id:c,lessons_per_week:parseInt(n.querySelector("#sub-lessons").value),shared_with_student_ids:[],teacherObject:s?l.currentUser:d.find(x=>x.id===c)};L&&L.student_subjects&&L.student_subjects.push(p),P();const y=await V(null,"create");document.getElementById("page-content").innerHTML=y}else{$("Adding subject...");try{const p=await ae(e),y={subject:n.querySelector("#sub-subject").value,educational_system:n.querySelector("#sub-system").value,grade:parseInt(n.querySelector("#sub-grade").value),teacher_id:c,lessons_per_week:parseInt(n.querySelector("#sub-lessons").value),shared_with_student_ids:[]},x=p.student_subjects.map(E=>({subject:E.subject,educational_system:E.educational_system,grade:E.grade,teacher_id:E.teacher_id,lessons_per_week:E.lessons_per_week,shared_with_student_ids:E.shared_with_student_ids}));x.push(y),await ie(e,{student_subjects:x}),P(),v("success","Subject added.");const N=await V(e,"edit");document.getElementById("page-content").innerHTML=N}catch(p){v("error",p.message)}finally{k()}}})})}async function gt(e,s){const t=e==="new";X("Remove Subject","Are you sure you want to drop this subject?",async()=>{if(t){L&&L.student_subjects&&L.student_subjects.splice(s,1),P();const r=await V(null,"create");document.getElementById("page-content").innerHTML=r}else{$("Removing subject...");try{const a=(await ae(e)).student_subjects.map(n=>({subject:n.subject,educational_system:n.educational_system,grade:n.grade,teacher_id:n.teacher_id,lessons_per_week:n.lessons_per_week,shared_with_student_ids:n.shared_with_student_ids}));a.splice(s,1),await ie(e,{student_subjects:a}),v("success","Subject removed.");const i=await V(e,"edit");document.getElementById("page-content").innerHTML=i}catch(r){v("error",r.message)}finally{k()}}})}function de(e){const s=document.getElementById("sidebar-nav");if(!s)return;let t="";e==="parent"?t='\n            <a href="#" id="nav-timetable" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-calendar-alt w-6 mr-3"></i> Timetable</a>\n            <a href="#" id="nav-tuitions" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-chalkboard-teacher w-6 mr-3"></i> Tuitions</a>\n            <a href="#" id="nav-notes" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-book-open w-6 mr-3"></i> Notes</a>\n            <a href="#" id="nav-logs" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-history w-6 mr-3"></i> Logs</a>\n            <a href="#" id="nav-student-info" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user-graduate w-6 mr-3"></i> Student Info</a>\n            <a href="#" id="nav-profile" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user-circle w-6 mr-3"></i> Profile</a>\n            <a href="#" id="nav-settings" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-cog w-6 mr-3"></i> Settings</a>\n        ':e==="student"?t='\n            <a href="#" id="nav-timetable" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-calendar-alt w-6 mr-3"></i> Timetable</a>\n            <a href="#" id="nav-tuitions" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-chalkboard-teacher w-6 mr-3"></i> Tuitions</a>\n            <a href="#" id="nav-notes" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-book-open w-6 mr-3"></i> Notes</a>\n            <a href="#" id="nav-profile" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user-circle w-6 mr-3"></i> Profile</a>\n            <a href="#" id="nav-settings" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-cog w-6 mr-3"></i> Settings</a>\n        ':e==="teacher"&&(t='\n            <a href="#" id="nav-teacher-tuition-logs" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-file-invoice-dollar w-6 mr-3"></i> Tuition Logs</a>\n            <a href="#" id="nav-teacher-payment-logs" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-money-check-alt w-6 mr-3"></i> Payment Logs</a>\n            <a href="#" id="nav-teacher-notes" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-book-open w-6 mr-3"></i> Notes</a>\n            <a href="#" id="nav-tuitions" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-chalkboard-teacher w-6 mr-3"></i> Tuitions</a>\n            <a href="#" id="nav-teacher-student-info" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-users w-6 mr-3"></i> Student Info</a>\n            <a href="#" id="nav-profile" class="nav-link flex items-center p-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user-circle w-6 mr-3"></i> Profile</a>\n        '),s.innerHTML=t,e?s.classList.remove("hidden"):s.classList.add("hidden")}function bt(){return'\n        <div class="max-w-md mx-auto mt-10 bg-gray-800 p-8 rounded-xl shadow-lg">\n            <img src="assets/EfficientTutor_logo.png" alt="EfficientTutor Logo" class="mx-auto h-16 w-auto mb-4">\n            <h3 id="auth-title" class="text-2xl font-bold text-center mb-6">Welcome - Log In</h3>\n            \n            <form id="auth-form" class="space-y-4">\n                \n                <!-- STEP 1: Credentials -->\n                <div id="step-1-container">\n                    <div id="first-name-group" class="hidden">\n                        <label for="firstName" class="block text-sm font-medium text-gray-400">First Name</label>\n                        <input type="text" id="firstName" placeholder="First Name" class="w-full mt-1 p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                    </div>\n\n                    <div id="last-name-group" class="hidden">\n                        <label for="lastName" class="block text-sm font-medium text-gray-400">Last Name</label>\n                        <input type="text" id="lastName" placeholder="Last Name" class="w-full mt-1 p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                    </div>\n\n                    <div id="role-group" class="hidden">\n                        <label for="role" class="block text-sm font-medium text-gray-400">I am a...</label>\n                        <select id="role" class="w-full mt-1 p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                            <option value="parent" selected>Parent</option>\n                            <option value="teacher">Teacher</option>\n                        </select>\n                    </div>\n\n                    <div>\n                        <label for="email" class="block text-sm font-medium text-gray-400">Email</label>\n                        <input type="email" id="email" placeholder="Email" required class="w-full mt-1 p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                    </div>\n                    <div>\n                         <label for="password" class="block text-sm font-medium text-gray-400">Password</label>\n                        <input type="password" id="password" placeholder="Password" required class="w-full mt-1 p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                    </div>\n                </div>\n\n                <!-- STEP 2: Teacher Specialties (Hidden by default) -->\n                <div id="step-2-container" class="hidden space-y-4">\n                    <h4 class="text-lg font-semibold text-indigo-400 border-b border-gray-700 pb-2">Add Your Specialties</h4>\n                    <p class="text-sm text-gray-400">Select subjects and the grade range you teach.</p>\n                    \n                    <div class="bg-gray-700 p-3 rounded-md space-y-3">\n                        <div class="grid grid-cols-2 gap-2">\n                            <div>\n                                <label class="text-xs text-gray-400">Subject</label>\n                                <select id="specialty-subject" class="w-full p-2 bg-gray-800 rounded border border-gray-600 text-sm"></select>\n                            </div>\n                            <div>\n                                <label class="text-xs text-gray-400">System</label>\n                                <select id="specialty-system" class="w-full p-2 bg-gray-800 rounded border border-gray-600 text-sm"></select>\n                            </div>\n                        </div>\n                        <div class="flex items-center space-x-2">\n                            <div class="flex-grow">\n                                <label class="text-xs text-gray-400">Grades (1-12)</label>\n                                <div class="flex items-center space-x-2">\n                                    <input type="number" id="specialty-grade-from" min="1" max="12" placeholder="From" class="w-full p-2 bg-gray-800 rounded border border-gray-600 text-sm">\n                                    <span class="text-gray-400">-</span>\n                                    <input type="number" id="specialty-grade-to" min="1" max="12" placeholder="To" class="w-full p-2 bg-gray-800 rounded border border-gray-600 text-sm">\n                                </div>\n                            </div>\n                            <button type="button" id="add-specialty-btn" class="mt-4 bg-green-600 hover:bg-green-500 text-white p-2 rounded-md"><i class="fas fa-plus"></i></button>\n                        </div>\n                    </div>\n\n                    <!-- List of Added Specialties -->\n                    <div id="specialties-list" class="space-y-2 max-h-48 overflow-y-auto">\n                        <!-- Dynamic items will go here -->\n                        <p class="text-center text-gray-500 text-sm py-2">No specialties added yet.</p>\n                    </div>\n                </div>\n                \n                <div id="auth-feedback" class="text-center min-h-[1.5rem]"></div>\n\n                <div class="flex flex-col space-y-3 pt-2">\n                    <button type="submit" id="auth-action-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-md transition duration-300">Login</button>\n                    \n                    <button type="button" id="auth-back-btn" class="hidden w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-md transition duration-300">Back</button>\n                    \n                    <button type="button" id="auth-toggle-btn" class="w-full text-indigo-400 hover:text-indigo-300 text-sm">Need an account? Sign Up</button>\n                </div>\n            </form>\n        </div>'}function pt(e,s){A("Confirm Deletion","<p>Are you sure you want to delete ".concat(e.firstName,"?</p>"),'\n        <div class="flex justify-end space-x-4">\n            <button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button>\n            <button id="modal-confirm-delete-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-md">Delete</button>\n        </div>',r=>{r.addEventListener("click",a=>{a.target.closest("#modal-confirm-delete-btn")&&(s(e.id),P()),a.target.closest("#modal-cancel-btn")&&P()})})}function ft(){if(l.students.length===0)return'\n            <div class="text-center py-12">\n                <i class="fas fa-user-graduate text-6xl text-gray-600 mb-4"></i>\n                <h3 class="text-xl font-semibold text-gray-300">No Students Yet</h3>\n                <p class="text-gray-500 mb-6">Add your children to start managing their schedule.</p>\n                <button id="btn-create-student" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-md transition duration-300">\n                    <i class="fas fa-plus mr-2"></i> Add New Student\n                </button>\n            </div>';const e=l.students.map(s=>'\n        <div class="bg-gray-800 p-6 rounded-lg shadow-lg hover:bg-gray-750 transition duration-300 border border-gray-700 flex flex-col">\n            <div class="flex justify-between items-start mb-4">\n                <div class="bg-indigo-900/50 p-3 rounded-full">\n                    <i class="fas fa-user-graduate text-2xl text-indigo-400"></i>\n                </div>\n                <span class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300 border border-gray-600">'.concat(s.status||"Active",'</span>\n            </div>\n            <h3 class="text-xl font-bold text-white mb-1">').concat(s.first_name," ").concat(s.last_name,'</h3>\n            <p class="text-gray-400 text-sm mb-4">Grade ').concat(s.grade,'</p>\n            \n            <div class="mt-auto pt-4 border-t border-gray-700 flex justify-between items-center">\n                <span class="text-xs text-gray-500">').concat((s.student_subjects||[]).length,' Subjects</span>\n                <button class="btn-view-student text-indigo-400 hover:text-indigo-300 text-sm font-semibold" data-id="').concat(s.id,'">\n                    Manage <i class="fas fa-arrow-right ml-1"></i>\n                </button>\n            </div>\n        </div>\n    ')).join("");return'\n        <div class="space-y-6">\n            <div class="flex justify-between items-center">\n                <h2 class="text-2xl font-bold">My Students</h2>\n                <button id="btn-create-student" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold py-2 px-4 rounded-md">\n                    <i class="fas fa-plus mr-2"></i> Add New\n                </button>\n            </div>\n            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">\n                '.concat(e,"\n            </div>\n        </div>")}async function yt(){if(!l.currentUser)return'<div class="text-center p-8 text-gray-400">You must be logged in to view logs.</div>';try{const[e,s]=await Promise.all([Be(),Ae()]),t=a=>a?new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",r=s.map(a=>{const i=a.attendee_names||[];return'\n                <div class="bg-gray-800 p-4 rounded-lg grid grid-cols-2 md:grid-cols-5 gap-4 items-center">\n                    <div>\n                        <p class="font-semibold">'.concat(a.subject,'</p>\n                        <p class="text-sm text-indigo-300">').concat(i.join(", "),'</p>\n                    </div>\n                    <div class="text-sm text-gray-400 text-center">\n                        <p>').concat(new Date(a.start_time).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),'</p>\n                        <p class="text-xs">').concat(t(a.start_time)," - ").concat(t(a.end_time),'</p>\n                    </div>\n                    <div class="text-center">').concat(a.duration,'</div>\n                    <div class="text-center font-semibold">').concat(a.cost,' kwd</div>\n                    <div class="text-center">\n                        <span class="px-3 py-1 rounded-full text-sm font-semibold ').concat(a.paid_status==="Paid"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400",'">\n                            ').concat(a.paid_status,"\n                        </span>\n                    </div>\n                </div>")}).join("");return'\n            <div class="space-y-6">\n                <div>\n                    <h3 class="text-xl font-semibold mb-4">Summary</h3>\n                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-red-500">'.concat(e.unpaid_count,'</p><p class="text-gray-400">Lessons Unpaid</p></div>\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-green-400">').concat(e.credit_balance,' kwd</p><p class="text-gray-400">Credit Balance</p></div>\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-yellow-400">').concat(e.total_due,' kwd</p><p class="text-gray-400">Total Amount Due</p></div>\n                    </div>\n                </div>\n                <div>\n                    <h3 class="text-xl font-semibold mb-4">Detailed Logs</h3>\n                    <div class="space-y-2">').concat(r,"</div>\n                </div>\n            </div>")}catch(e){return console.error("Error fetching logs:",e),'<div class="text-center text-red-400 p-8">Error loading logs: '.concat(e.message,"</div>")}}function vt(){const e=document.documentElement.classList.contains("dark");return'\n        <div class="max-w-2xl mx-auto space-y-6">\n            <div class="bg-gray-800 p-6 rounded-lg">\n                <h3 class="text-lg font-semibold mb-4">Appearance</h3>\n                <div class="flex items-center justify-between">\n                    <span>Theme</span>\n                    <button id="theme-toggle-btn" class="px-4 py-2 rounded-md font-semibold '.concat(e?"bg-gray-700":"bg-gray-300 text-gray-800",'">\n                        ').concat(e?'<i class="fas fa-moon mr-2"></i>Dark':'<i class="fas fa-sun mr-2"></i>Light','\n                    </button>\n                </div>\n            </div>\n            <div class="bg-gray-800 p-6 rounded-lg">\n                <h3 class="text-lg font-semibold mb-4">About</h3>\n                <p class="text-gray-400">EfficientTutor ').concat(w.version,"</p>\n            </div>\n        </div>")}function ht(e,s){const{tuition:t,start_time:r,end_time:a}=e;if(!t)return"";let i="";if(r){const g=new Date(r).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),d="".concat(new Date(r).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," - ").concat(new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}));i='\n            <p class="text-lg font-semibold capitalize">'.concat(g,'</p>\n            <p class="text-sm text-gray-400">').concat(d,"</p>\n        ")}else i='<p class="text-lg font-semibold text-yellow-400">Unscheduled</p>';let n="";if(s==="teacher"){const g=(t.charges||[]).map(d=>"".concat(d.student.first_name," ").concat(d.student.last_name));n='<p class="text-sm text-gray-400">'.concat(g.join(", "),"</p>")}else n='<p class="text-sm text-gray-400">'.concat((t.attendee_names||[]).join(", "),"</p>");let o="",u="";const b=t.meeting_link&&t.meeting_link.meeting_link;if(s==="teacher"){const g=(t.charges||[]).map(d=>'\n            <li class="flex justify-between items-center text-sm">\n                <span>'.concat(d.student.first_name," ").concat(d.student.last_name,'</span>\n                <span class="font-semibold">').concat(d.cost," kwd</span>\n            </li>\n        ")).join("");o='\n            <div>\n                <h4 class="text-sm font-semibold text-gray-400 mb-2">Charges</h4>\n                <ul class="space-y-1">'.concat(g||'<li class="text-sm text-gray-500">No charges set.</li>',"</ul>\n            </div>\n        "),u='\n            <div>\n                <h4 class="text-sm font-semibold text-gray-400 mb-2">Meeting Link</h4>\n                '.concat(b?'<button class="view-meeting-link-btn w-full p-2 text-sm bg-blue-600 hover:bg-blue-500 rounded-md" data-tuition-id="'.concat(t.id,'"><i class="fas fa-external-link-alt mr-2"></i>View Link</button>'):'<p class="text-gray-500 text-sm">No meeting link assigned.</p>','\n                <div class="flex items-center space-x-2 mt-3">\n                     <button title="Set Link" class="edit-meeting-link-btn w-full p-2 text-sm bg-gray-600 hover:bg-gray-500 rounded-md" data-tuition-id="').concat(t.id,'"><i class="fas fa-edit"></i> ').concat(b?"Edit":"Set"," Link</button>\n                </div>\n            </div>\n        ")}else s==="parent"?(o='\n            <div>\n                <h4 class="text-sm font-semibold text-gray-400 mb-2">Your Charge</h4>\n                <p class="text-2xl font-bold text-indigo-300">'.concat(t.charge," kwd</p>\n            </div>\n        "),b&&(u='\n                <div class="self-center">\n                    <button class="view-meeting-link-btn w-full p-2 text-sm bg-blue-600 hover:bg-blue-500 rounded-md" data-tuition-id="'.concat(t.id,'"><i class="fas fa-external-link-alt mr-2"></i>View Link</button>\n                </div>\n            '))):(o="<div></div>",b&&(u='\n                <div class="flex flex-col space-y-2">\n                    <button class="view-meeting-link-btn w-full p-2 text-sm bg-blue-600 hover:bg-blue-500 rounded-md" data-tuition-id="'.concat(t.id,'"><i class="fas fa-external-link-alt mr-2"></i>View Details</button>\n                    <a href="').concat(t.meeting_link.meeting_link,'" target="_blank" rel="noopener noreferrer" class="w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">Join Meeting</a>\n                </div>\n            ')));return'\n        <div class="bg-gray-800 p-4 rounded-lg shadow-md">\n            <div class="flex justify-between items-start mb-4">\n                <div>\n                    <h3 class="font-semibold text-xl text-indigo-300">'.concat(t.subject,"</h3>\n                    ").concat(n,'\n                </div>\n                <div class="text-right flex-shrink-0 ml-4">\n                    ').concat(i,'\n                </div>\n            </div>\n\n            <div class="mt-4 pt-4 border-t border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-6">\n                <div>\n                    <h4 class="text-sm font-semibold text-gray-400 mb-2">Details</h4>\n                    <div class="text-sm space-y-1">\n                        <p class="flex justify-between"><span>Duration:</span> <span class="font-semibold">').concat(t.min_duration_minutes||"N/A",' mins</span></p>\n                        <p class="flex justify-between"><span>Lesson Index:</span> <span class="font-semibold">').concat(t.lesson_index||"N/A","</span></p>\n                    </div>\n                </div>\n                ").concat(o,"\n                ").concat(u,"\n            </div>\n        </div>\n    ")}async function xt(){try{$("Loading tuitions...");const[e,s]=await Promise.all([Ce(),Vt()]),t=[],r=new Set;if(Array.isArray(e)&&e.forEach(n=>{n.tuition&&(t.push(n),r.add(n.tuition.id))}),Array.isArray(s)&&s.forEach(n=>{r.has(n.id)||t.push({start_time:null,end_time:null,tuition:n})}),l.teacherScheduledTuitions=t,k(),t.length===0)return'<div class="text-center p-8 text-gray-400">No tuitions found.</div>';const a=l.currentUser.role,i=t.map(n=>ht(n,a)).join("");return'<div class="space-y-6">'.concat(i,"</div>")}catch(e){return console.error("Error rendering tuitions page:",e),k(),'<div class="text-center text-red-400 p-8">Error loading tuitions: '.concat(e.message,"</div>")}}function wt(){return'<div class="p-8 text-center text-gray-400">The Timetables feature for teachers is not yet implemented.</div>'}function St(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric",timeZone:"UTC"})}catch(s){return"Invalid Date"}}function fe(e){if(!e)return"N/A";try{return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"UTC"})}catch(s){return"Invalid Time"}}function $t(e){if(e.length===0)return'<div class="text-center p-8 text-gray-400">No tuition logs found.</div>';e.sort((t,r)=>new Date(r.start_time)-new Date(t.start_time));const s=e.map(t=>{const r=t.status==="VOID",a=r?"opacity-50 bg-gray-800/50":"bg-gray-800";return'\n            <tr class="'.concat(a,'">\n                <td class="p-3 font-mono text-center">').concat(t.week_number,'</td>\n                <td class="p-3">').concat(St(t.start_time),'</td>\n                <td class="p-3">').concat(fe(t.start_time),'</td>\n                <td class="p-3">').concat(fe(t.end_time),'</td>\n                <td class="p-3 text-center">').concat(t.duration,'</td>\n                <td class="p-3">').concat(t.subject,'</td>\n                <td class="p-3">').concat((t.charges||[]).map(i=>i.student_name).join("<br>"),'</td>\n                <td class="p-3">\n                    <div class="flex items-center justify-between">\n                        <span>').concat(t.total_cost,' kwd</span>\n                        <button title="View Charge Details" class="view-charges-btn text-blue-400 hover:text-blue-300" data-log-id="').concat(t.id,'"><i class="fas fa-info-circle"></i></button>\n                    </div>\n                </td>\n                <td class="p-3"><span class="px-2 py-1 text-xs rounded-full ').concat(t.paid_status==="Paid"?"bg-green-500/30 text-green-300":"bg-red-500/30 text-red-300",'">').concat(t.paid_status,'</span></td>\n                <td class="p-3"><span class="px-2 py-1 text-xs rounded-full ').concat(r?"bg-gray-500/30 text-gray-300":"bg-blue-500/30 text-blue-300",'">').concat(t.status,'</span></td>\n                <td class="p-3 text-gray-400">').concat(t.create_type,'</td>\n                <td class="p-3">\n                    <div class="flex items-center space-x-2">\n                        <button title="Correct Log" class="correct-log-btn p-2 text-sm bg-yellow-600 hover:bg-yellow-500 rounded-md ').concat(r?"hidden":"","\" data-log-id='").concat(t.id,'\'><i class="fas fa-edit"></i></button>\n                        <button title="Void Log" class="void-log-btn p-2 text-sm bg-red-600 hover:bg-red-500 rounded-md ').concat(r?"hidden":"",'" data-log-id="').concat(t.id,'"><i class="fas fa-ban"></i></button>\n                    </div>\n                </td>\n            </tr>')}).join("");return'<div class="overflow-x-auto"><table class="w-full text-left text-sm whitespace-nowrap"><thead class="bg-gray-900/80"><tr><th class="p-3 text-center">Week #</th><th class="p-3">Date</th><th class="p-3">Start Time</th><th class="p-3">End Time</th><th class="p-3 text-center">Duration</th><th class="p-3">Subject</th><th class="p-3">Attendees</th><th class="p-3">Total Cost</th><th class="p-3">Paid Status</th><th class="p-3">Log Status</th><th class="p-3">Type</th><th class="p-3">Actions</th></tr></thead><tbody>'.concat(s,"</tbody></table></div>")}async function _t(){try{const[e,s]=await Promise.all([Be(),Ae()]);l.teacherTuitionLogs=s;const t=$t(s);return'\n            <div class="space-y-6">\n                <div class="flex justify-between items-center">\n                    <h2 class="text-2xl font-bold">Tuition Logs</h2>\n                    <button id="add-new-log-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300"><i class="fas fa-plus mr-2"></i> Add New Log</button>\n                </div>\n                <div>\n                    <h3 class="text-xl font-semibold mb-4">Summary</h3>\n                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-blue-400">'.concat(e.total_lessons_given_this_month,'</p><p class="text-gray-400">Lessons This Month</p></div>\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-green-400">').concat(e.total_credit_held,' kwd</p><p class="text-gray-400">Total Credit Held</p></div>\n                        <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-yellow-400">').concat(e.total_owed_to_teacher,' kwd</p><p class="text-gray-400">Total Owed to You</p></div>\n                    </div>\n                </div>\n                ').concat(t,"\n            </div>")}catch(e){return console.error("Error rendering tuition logs page:",e),'<div class="text-center text-red-400 p-8">Error loading tuition logs: '.concat(e.message,"</div>")}}function kt(e){A("Confirm Void","<p>Are you sure you want to void this log? This action cannot be undone.</p>",'<div class="flex justify-end space-x-4"><button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button><button id="modal-confirm-void-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-md">Void Log</button></div>',r=>{r.querySelector("#modal-confirm-void-btn").addEventListener("click",async()=>{$("Voiding log...");try{await Yt(e),P(),v("success","Log voided successfully."),T()}catch(a){v("error",a.message)}})})}function Lt(e){var i;const s=(i=l.teacherTuitionLogs)==null?void 0:i.find(n=>n.id===e);if(!s||!s.charges){v("error","Charge details not available.");return}const t=s.charges.map(n=>'<li class="flex justify-between items-center p-2 bg-gray-700 rounded-md"><span>'.concat(n.student_name,'</span><span class="font-semibold">').concat(n.cost," kwd</span></li>")).join(""),r='<ul class="space-y-2">'.concat(t,"</ul>");A("Cost Breakdown",r,'<div class="flex justify-end"><button id="modal-close-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Close</button></div>')}async function ye(e=null){const s=e!==null;let t={};const r=()=>{const n=new Date,o=(e==null?void 0:e.start_time)||t.scheduled_start_time||n.toISOString(),u=(e==null?void 0:e.end_time)||t.scheduled_end_time||new Date(n.getTime()+3600*1e3).toISOString(),b=new Date(o).toISOString().slice(0,16),g=new Date(u).toISOString().slice(0,16);let d="",c=t.subject;if(t.log_type==="custom"){const y=t.charges.map(x=>{const N=x.student_name||t.all_students.find(E=>E.id===x.student_id).first_name;return"".concat(N," (").concat(x.cost," kwd)")}).join(", ");d='<div><p class="text-sm text-gray-400">Attendees: <span class="font-semibold text-gray-200">'.concat(y,"</span></p></div>"),t.educational_system&&t.grade&&(c="".concat(t.subject," (").concat(t.educational_system," - Grade ").concat(t.grade,")"))}else d='<div><p class="text-sm text-gray-400">Attendees: <span class="font-semibold text-gray-200">'.concat(t.student_names.join(", "),"</span></p></div>");const m='\n            <div class="space-y-4">\n                <div><p class="text-sm text-gray-400">Subject: <span class="font-semibold text-gray-200">'.concat(c,"</span></p></div>\n                ").concat(d,"\n                ").concat(t.log_type==="custom"?'<div><label class="text-sm text-gray-400">Lesson Index</label><input type="number" id="log-lesson-index" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="'.concat((e==null?void 0:e.lesson_index)||1,'" min="1"></div>'):"",'\n                <div class="grid grid-cols-2 gap-4">\n                    <div><label class="text-sm text-gray-400">Start Time</label><input type="datetime-local" id="log-start-time" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="').concat(b,'"></div>\n                    <div><label class="text-sm text-gray-400">End Time</label><input type="datetime-local" id="log-end-time" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="').concat(g,'"></div>\n                </div>\n            </div>');A(s?"Correct Tuition Log":"Add Tuition Log",m,'<div class="flex justify-end"><button id="submit-log-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Submit</button></div>',y=>{y.querySelector("#submit-log-btn").addEventListener("click",async()=>{let x={};t.log_type==="scheduled"?x={log_type:"SCHEDULED",tuition_id:t.tuition_id,start_time:new Date(y.querySelector("#log-start-time").value).toISOString(),end_time:new Date(y.querySelector("#log-end-time").value).toISOString()}:x={log_type:"CUSTOM",teacher_id:l.currentUser.id,subject:t.subject,educational_system:t.educational_system,grade:t.grade,lesson_index:parseInt(y.querySelector("#log-lesson-index").value),start_time:new Date(y.querySelector("#log-start-time").value).toISOString(),end_time:new Date(y.querySelector("#log-end-time").value).toISOString(),charges:t.charges},$("Saving log...");try{s?await Zt(e.id,x):await Jt(x),P(),v("success","Log saved successfully."),T()}catch(N){v("error",N.message)}})})},a=async()=>{$("Fetching tuitions...");try{const n=await Kt();k();const o=g=>{if(!g)return"";try{const d=new Date(g);return new Intl.DateTimeFormat("en-US",{weekday:"short",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"UTC"}).format(d)}catch(d){return""}},u=n.map(g=>{const d=o(g.scheduled_start_time);return'<li class="p-3 hover:bg-gray-700 rounded-md cursor-pointer scheduled-item" data-tuition-id="'.concat(g.id,'">').concat(g.subject," - ").concat((g.student_names||[]).join(", ")," ").concat(d?'<span class="text-gray-400">- '.concat(d,"</span>"):"","</li>")}).join(""),b='<div><h3 class="font-semibold mb-2">Select a Scheduled Tuition</h3><ul class="space-y-1 max-h-60 overflow-y-auto">'.concat(u,"</ul></div>");A("Add From Schedule",b,"",g=>{g.querySelectorAll(".scheduled-item").forEach(d=>{d.addEventListener("click",()=>{const c=n.find(p=>p.id===d.dataset.tuitionId),m=(c.charges||[]).map(p=>p.student_name);t={log_type:"scheduled",tuition_id:c.id,subject:c.subject,student_names:m,scheduled_start_time:c.scheduled_start_time,scheduled_end_time:c.scheduled_end_time},r()})})})}catch(n){k(),v("error",n.message)}},i=async()=>{$("Fetching data...");try{const[n,o]=await Promise.all([ne(),He(l.currentUser.id)]);k();const u=n.map(c=>{const m=s?e.charges.find(N=>N.student_id===c.id):null,p=m?"checked":"",y=m?m.cost:"",x=m?"":"hidden";return'<label class="flex items-center justify-between p-2 hover:bg-gray-600 rounded-md"><div class="flex items-center space-x-2"><input type="checkbox" class="student-checkbox" data-student-id="'.concat(c.id,'" data-student-name="').concat(c.first_name,'" ').concat(p,"><span>").concat(c.first_name," ").concat(c.last_name,'</span></div><div class="w-24"><input type="number" class="student-cost-input w-full p-1 bg-gray-800 rounded-md border border-gray-500 text-sm ').concat(x,'" placeholder="Cost" step="0.5" value="').concat(y,'"></div></label>')}).join("");let b="";o.length===0?b='<option value="" disabled selected>No specialties found. Please add specialties in your profile.</option>':b=o.map(c=>'<option value="'.concat(c.id,'">').concat(c.subject," (").concat(c.educational_system," - Grade ").concat(c.grade,")</option>")).join("");const g='\n                <div class="space-y-4">\n                    <div>\n                        <label class="text-sm text-gray-400">Select Students & Set Cost</label>\n                        <div class="max-h-40 overflow-y-auto space-y-1 mt-1 border border-gray-600 p-2 rounded-md">'.concat(u,'</div>\n                    </div>\n                    <div>\n                        <label class="text-sm text-gray-400">Select Specialty</label>\n                        <select id="custom-specialty" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" ').concat(o.length===0?"disabled":"",">\n                            ").concat(b,"\n                        </select>\n                    </div>\n                </div>"),d='<div class="flex justify-end"><button id="next-custom-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md" '.concat(o.length===0?"disabled":"",">Next</button></div>");A("Add Custom Log",g,d,c=>{if(s&&e.educational_system&&e.grade){const m=o.find(p=>p.subject===e.subject&&p.educational_system===e.educational_system&&p.grade===e.grade);m&&(c.querySelector("#custom-specialty").value=m.id)}c.querySelectorAll(".student-checkbox").forEach(m=>{m.addEventListener("change",p=>{p.target.closest("label").querySelector(".student-cost-input").classList.toggle("hidden",!p.target.checked)})}),c.querySelector("#next-custom-btn").addEventListener("click",()=>{const m=[],p=[];let y=!0;if(c.querySelectorAll(".student-checkbox:checked").forEach(E=>{if(!y)return;const U=E.closest("label").querySelector(".student-cost-input"),q=parseFloat(U.value);if(isNaN(q)||q<=0){alert("Please enter a valid cost for ".concat(E.dataset.studentName,".")),y=!1;return}m.push({student_id:E.dataset.studentId,cost:q}),p.push(E.dataset.studentName)}),!y||m.length===0){y&&alert("Please select at least one student and enter their cost.");return}const x=c.querySelector("#custom-specialty").value,N=o.find(E=>E.id===x);t={log_type:"custom",charges:m,student_names:p,all_students:n,subject:N.subject,educational_system:N.educational_system,grade:N.grade},r()})})}catch(n){k(),v("error",n.message)}};if(s){const n=(e.charges||[]).map(o=>o.student_name);t={log_type:e.create_type.toLowerCase(),subject:e.subject,educational_system:e.educational_system,grade:e.grade,student_names:n,tuition_id:e.tuition_id,charges:e.charges},t.log_type==="custom"?await i():r()}else A("Add New Tuition Log",'<div class="flex space-x-4"><button id="from-schedule-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md">From Schedule</button><button id="custom-entry-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-md">Custom Entry</button></div>',"",o=>{o.querySelector("#from-schedule-btn").addEventListener("click",a),o.querySelector("#custom-entry-btn").addEventListener("click",i)})}function Et(e){if(e.length===0)return'<div class="text-center p-8 text-gray-400">No payment logs found.</div>';e.sort((t,r)=>new Date(r.payment_date)-new Date(t.payment_date));const s=e.map(t=>{const r=t.status==="VOID",a=r?"opacity-50 bg-gray-800/50":"bg-gray-800";return'\n            <tr class="'.concat(a,'">\n                <td class="p-3">').concat(new Date(t.payment_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),'</td>\n                <td class="p-3">').concat(t.parent_name,'</td>\n                <td class="p-3">').concat(t.amount_paid," ").concat(t.currency,'</td>\n                <td class="p-3 text-gray-400 italic">').concat(t.notes||"–",'</td>\n                <td class="p-3"><span class="px-2 py-1 text-xs rounded-full ').concat(r?"bg-red-500/30 text-red-300":"bg-green-500/30 text-green-300",'">').concat(t.status,'</span></td>\n                <td class="p-3">\n                    <div class="flex items-center space-x-2">\n                        <button title="Correct Log" class="correct-payment-log-btn p-2 text-sm bg-yellow-600 hover:bg-yellow-500 rounded-md ').concat(r?"hidden":"",'" data-log-id="').concat(t.id,'"><i class="fas fa-edit"></i></button>\n                        <button title="Void Log" class="void-payment-log-btn p-2 text-sm bg-red-600 hover:bg-red-500 rounded-md ').concat(r?"hidden":"",'" data-log-id="').concat(t.id,'"><i class="fas fa-ban"></i></button>\n                    </div>\n                </td>\n            </tr>')}).join("");return'<div class="overflow-x-auto"><table class="w-full text-left text-sm whitespace-nowrap"><thead class="bg-gray-900/80"><tr><th class="p-3">Date</th><th class="p-3">Parent</th><th class="p-3">Amount Paid</th><th class="p-3">Notes</th><th class="p-3">Status</th><th class="p-3">Actions</th></tr></thead><tbody>'.concat(s,"</tbody></table></div>")}async function ve(){try{const e=await Gt();l.teacherPaymentLogs=e;const s=Et(e);return'\n            <div class="space-y-6">\n                <div class="flex justify-between items-center">\n                    <h2 class="text-2xl font-bold">Payment Logs</h2>\n                    <button id="add-new-payment-log-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300"><i class="fas fa-plus mr-2"></i> Add Payment</button>\n                </div>\n                '.concat(s,"\n            </div>")}catch(e){return console.error("Error rendering payment logs page:",e),'<div class="text-center text-red-400 p-8">Error loading payment logs: '.concat(e.message,"</div>")}}async function he(e=null){const s=e!==null;$("Loading...");try{const t=await Qt();k();const r=t.map(n=>'<option value="'.concat(n.id,'">').concat(n.first_name," ").concat(n.last_name,"</option>")).join(""),a='<div class="space-y-4"><div><label class="text-sm text-gray-400">Parent</label><select id="payment-parent-id" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">'.concat(r,'</select></div><div class="grid grid-cols-2 gap-4"><div><label class="text-sm text-gray-400">Payment Date</label><input type="date" id="payment-date" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></div><div><label class="text-sm text-gray-400">Amount Paid</label><input type="number" id="payment-amount" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" step="0.5" placeholder="0.00"></div></div><div><label class="text-sm text-gray-400">Notes (Optional)</label><textarea id="payment-notes" rows="3" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></textarea></div></div>');A(s?"Correct Payment Log":"Add Payment Log",a,'<div class="flex justify-end"><button id="submit-payment-log-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Submit</button></div>',n=>{if(s){const o=t.find(u=>"".concat(u.first_name," ").concat(u.last_name)===e.parent_name);o&&(n.querySelector("#payment-parent-id").value=o.id),n.querySelector("#payment-date").value=new Date(e.payment_date).toISOString().split("T")[0],n.querySelector("#payment-amount").value=e.amount_paid,n.querySelector("#payment-notes").value=e.notes||""}else n.querySelector("#payment-date").value=new Date().toISOString().split("T")[0];n.querySelector("#submit-payment-log-btn").addEventListener("click",async()=>{const o={teacher_id:l.currentUser.id,parent_id:n.querySelector("#payment-parent-id").value,amount_paid:parseFloat(n.querySelector("#payment-amount").value),notes:n.querySelector("#payment-notes").value,payment_date:new Date(n.querySelector("#payment-date").value).toISOString()};if(!o.parent_id||!o.amount_paid||!o.payment_date){alert("Please fill in Parent, Date, and Amount.");return}$("Saving payment...");try{s?await ts(e.id,o):await Xt(o),P(),v("success","Payment log saved."),T()}catch(u){v("error",u.message)}})})}catch(t){k(),v("error","Could not load data: ".concat(t.message))}}function jt(e){A("Confirm Void","<p>Are you sure you want to void this payment log? This action cannot be undone.</p>",'<div class="flex justify-end space-x-4"><button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Cancel</button><button id="modal-confirm-void-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-md">Void Log</button></div>',r=>{r.querySelector("#modal-confirm-void-btn").addEventListener("click",async()=>{$("Voiding payment...");try{await es(e),P(),v("success","Payment log voided."),T()}catch(a){v("error",a.message)}})})}function Tt(e){const s=e.meeting_link,t=s?s.meeting_link:"",r=s?s.meeting_password:"",a=s?s.meeting_id:"",i='\n        <div class="space-y-4">\n            <div>\n                <label for="meeting-url" class="block text-sm font-medium text-gray-400">Meeting URL</label>\n                <input type="text" id="meeting-url" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="'.concat(t||"",'" placeholder="https://meet.google.com/abc-def-ghi">\n            </div>\n            <div>\n                <label for="meeting-id" class="block text-sm font-medium text-gray-400">Meeting ID (optional)</label>\n                <input type="text" id="meeting-id" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="').concat(a||"",'" placeholder="abc-def-ghi">\n                <p class="text-xs text-gray-500 mt-1">If left empty, will be auto-detected from Google Meet URLs.</p>\n            </div>\n            <div>\n                <label for="meeting-password" class="block text-sm font-medium text-gray-400">Password (optional)</label>\n                <input type="text" id="meeting-password" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" value="').concat(r||"",'">\n            </div>\n        </div>'),n=s?'<button title="Delete Link" class="delete-meeting-link-btn p-2 px-4 text-sm bg-red-600 hover:bg-red-500 rounded-md" data-tuition-id="'.concat(e.id,'"><i class="fas fa-trash"></i> Delete</button>'):"",o='\n        <div class="flex justify-between items-center w-full">\n            '.concat(n,'\n            <div class="flex-grow flex justify-end space-x-4">\n                 <button id="modal-close-btn" class="p-2 px-4 text-sm bg-gray-600 hover:bg-gray-500 rounded-md">Cancel</button>\n                 <button id="submit-meeting-link-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Save</button>\n            </div>\n        </div>');A("Add/Edit Meeting Link",i,o,u=>{u.querySelector("#submit-meeting-link-btn").addEventListener("click",async()=>{const b=u.querySelector("#meeting-url").value.trim(),g=u.querySelector("#meeting-password").value.trim(),d=u.querySelector("#meeting-id").value.trim();if(!b){if(s){$("Deleting link...");try{await Oe(e.id),P(),v("success","Meeting link deleted."),T()}catch(m){v("error","Failed to delete link: ".concat(m.message))}}else P();return}if(!/^(https?:\/\/)?([\w\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(b)){v("error","Please enter a valid URL format.");return}$("Saving link...");try{s?await ns(e.id,b,g,d):await ss(e.id,b,g,d),P(),v("success","Meeting link saved."),T()}catch(m){m.message.includes("Input should be a valid URL")?v("error","The provided URL is not valid. Please check and try again."):v("error","Failed to save link: ".concat(m.message))}})})}function Pt(e){const s=e.meeting_link;if(!s){v("info","No meeting link is set for this tuition.");return}const t='\n        <div class="space-y-3 text-sm">\n            <div><label class="text-xs text-gray-400">Subject</label><p class="font-semibold text-base">'.concat(e.subject,'</p></div>\n            <div class="border-t border-gray-700 pt-3"><label class="text-xs text-gray-400">URL</label><a href="').concat(s.meeting_link,'" target="_blank" rel="noopener noreferrer" class="block break-all text-blue-400 hover:underline">').concat(s.meeting_link,'</a></div>\n            <div><label class="text-xs text-gray-400">Meeting ID</label><p class="font-mono">').concat(s.meeting_id||"None",'</p></div>\n            <div><label class="text-xs text-gray-400">Password</label><p class="font-mono">').concat(s.meeting_password||"None","</p></div>\n        </div>");A("Meeting Link Details",t,'\n        <div class="flex justify-end w-full">\n            <button id="modal-close-btn" class="p-2 px-4 text-sm bg-gray-600 hover:bg-gray-500 rounded-md">Close</button>\n        </div>')}async function It(){try{$("Loading Students...");const e=await ne();if(k(),e.length===0)return'<div class="text-center text-gray-400 p-8">You have no students assigned yet.</div>';const s=e.map(t=>'<option value="'.concat(t.id,'">').concat(t.first_name," ").concat(t.last_name," (Grade ").concat(t.grade,")</option>")).join("");return'\n            <div class="space-y-6">\n                <div class="flex justify-between items-center">\n                    <h2 class="text-2xl font-bold">Student Information</h2>\n                </div>\n                <div class="bg-gray-800 p-4 rounded-lg">\n                    <label class="block text-sm font-medium text-gray-400 mb-2">Select Student to Manage</label>\n                    <select id="teacher-student-selector" class="w-full p-3 bg-gray-700 rounded-md border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none">\n                        <option value="">-- Select a Student --</option>\n                        '.concat(s,'\n                    </select>\n                </div>\n                <div id="teacher-student-profile-container">\n                    <div class="text-center text-gray-500 py-8">Select a student above to view and edit their details.</div>\n                </div>\n            </div>\n        ')}catch(e){return console.error("Error rendering teacher student info page:",e),'<div class="text-center text-red-400 p-8">Error loading student information: '.concat(e.message,"</div>")}}async function xe(){l.currentUser.role==="student"&&(l.notesStudentFilter=l.currentUser.id);try{$("Loading Notes...");const e=await as();if(l.notes=e,l.currentUser.role!=="student"){const a=await ne();l.allStudents=a}k();const s=Nt(),t=l.notesStudentFilter?l.notes.filter(a=>a.student.id===l.notesStudentFilter):[],r=Ct(t);return'\n            <div class="space-y-6">\n                <div class="flex justify-between items-center">\n                    <h2 class="text-2xl font-bold">Notes</h2>\n                    '.concat(l.currentUser.role==="teacher"?'<button id="add-new-note-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300"><i class="fas fa-plus mr-2"></i> Add New Note</button>':"","\n                </div>\n                ").concat(s,'\n                <div id="notes-content-container">\n                    ').concat(r,"\n                </div>\n            </div>\n        ")}catch(e){return k(),console.error("Error rendering notes page:",e),'<div class="text-center text-red-400 p-8">Error loading notes: '.concat(e.message,"</div>")}}function Nt(){var r;const e=(r=l.currentUser)==null?void 0:r.role;if(e!=="parent"&&e!=="teacher")return"";const s=l.allStudents||[];if(s.length===0)return'<p class="text-gray-400">No students found.</p>';const t=s.map(a=>'<option value="'.concat(a.id,'" ').concat(l.notesStudentFilter===a.id?"selected":"",">\n            ").concat(a.first_name," ").concat(a.last_name,"\n        </option>")).join("");return'\n        <div class="max-w-sm">\n            <label for="notes-student-selector" class="block text-sm font-medium text-gray-400">Viewing Notes For:</label>\n            <select id="notes-student-selector" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                <option value="">Select a student...</option>\n                '.concat(t,"\n            </select>\n        </div>\n    ")}function Ct(e){if(!l.notesStudentFilter)return'<div class="text-center p-8 text-gray-400 bg-gray-800 rounded-lg">Please select a student to view their notes.</div>';if(e.length===0)return'<div class="text-center p-8 text-gray-400 bg-gray-800 rounded-lg">No notes found for this student.</div>';const s=e.reduce((r,a)=>(r[a.subject]||(r[a.subject]=0),r[a.subject]++,r),{}),t=Object.entries(s).map(([r,a])=>'\n        <div class="subject-card-button bg-gray-800 hover:bg-indigo-800/50 p-6 rounded-lg text-center cursor-pointer transition-all duration-300 transform hover:scale-105" data-subject="'.concat(r,'">\n            <i class="fas fa-folder text-4xl text-indigo-400 mb-3"></i>\n            <h3 class="font-bold text-lg">').concat(r,'</h3>\n            <p class="text-sm text-gray-400">').concat(a," ").concat(a===1?"Note":"Notes","</p>\n        </div>\n    ")).join("");return'\n        <div>\n            <h3 class="text-xl font-semibold mb-4">Subjects</h3>\n            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">\n                '.concat(t,'\n            </div>\n        </div>\n        <div id="notes-list-container" class="mt-8"></div>\n    ')}function At(e){var i;const s=l.notes.filter(n=>n.student.id===l.notesStudentFilter&&n.subject===e);if(s.length===0)return'<p class="text-gray-400">No notes found for this subject.</p>';const t=s.reduce((n,o)=>{const u=o.note_type;return n[u]||(n[u]=[]),n[u].push(o),n},{}),r=((i=l.currentUser)==null?void 0:i.role)==="teacher",a=Object.entries(t).map(([n,o])=>{const u=n.replace(/_/g," ").replace(/\w\S*/g,g=>g.charAt(0).toUpperCase()+g.substr(1).toLowerCase()),b=o.map(g=>{const d=r?'\n                <div class="flex-shrink-0 space-x-2">\n                    <button title="Edit Note" class="edit-note-btn p-2 text-sm bg-gray-600 hover:bg-gray-500 rounded-md" data-note-id="'.concat(g.id,'"><i class="fas fa-edit"></i></button>\n                    <button title="Delete Note" class="delete-note-btn p-2 text-sm bg-red-600 hover:bg-red-500 rounded-md" data-note-id="').concat(g.id,'"><i class="fas fa-trash"></i></button>\n                </div>\n            '):"";return'\n                <div class="bg-gray-800 p-4 rounded-lg flex items-start justify-between gap-4">\n                    <div class="flex-grow">\n                        <h4 class="font-semibold text-md text-indigo-300">'.concat(g.name,'</h4>\n                        <p class="text-sm text-gray-400 my-2">').concat(g.description||"No description.","</p>\n                        ").concat(g.url?'<a href="'.concat(g.url,'" target="_blank" rel="noopener noreferrer" class="inline-block text-sm text-blue-400 hover:underline">Open Link <i class="fas fa-external-link-alt ml-1"></i></a>'):"","\n                    </div>\n                    ").concat(d,"\n                </div>\n            ")}).join("");return'\n            <div class="mb-6">\n                <h3 class="text-lg font-semibold text-gray-300 mb-3">'.concat(u,'</h3>\n                <div class="space-y-3">\n                    ').concat(b,"\n                </div>\n            </div>\n        ")}).join("");return'\n        <div class="mt-6">\n            <button id="back-to-subjects-btn" class="text-sm text-indigo-400 hover:underline mb-4"><i class="fas fa-arrow-left mr-2"></i>Back to Subjects</button>\n            <h2 class="text-2xl font-bold mb-4">Notes for '.concat(e,"</h2>\n            ").concat(a,"\n        </div>\n    ")}function Bt(){const e=l.allStudents.map(i=>'<option value="'.concat(i.id,'">').concat(i.first_name," ").concat(i.last_name,"</option>")).join(""),s=w.noteSubjects.map(i=>'<option value="'.concat(i,'">').concat(i,"</option>")).join(""),t=w.noteTypes.map(i=>'<option value="'.concat(i,'">').concat(i.replace(/_/g," "),"</option>")).join(""),r='\n        <div class="space-y-4">\n            <div>\n                <label for="note-student-id" class="block text-sm font-medium text-gray-400">Student</label>\n                <select id="note-student-id" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">'.concat(e,'</select>\n            </div>\n            <div class="grid grid-cols-2 gap-4">\n                <div>\n                    <label for="note-subject" class="block text-sm font-medium text-gray-400">Subject</label>\n                    <select id="note-subject" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(s,'</select>\n                </div>\n                <div>\n                    <label for="note-type" class="block text-sm font-medium text-gray-400">Note Type</label>\n                    <select id="note-type" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(t,'</select>\n                </div>\n            </div>\n            <div>\n                <label for="note-name" class="block text-sm font-medium text-gray-400">Note Name</label>\n                <input type="text" id="note-name" placeholder="e.g., Algebra Chapter 5 Review" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n            </div>\n            <div>\n                <label for="note-description" class="block text-sm font-medium text-gray-400">Description</label>\n                <textarea id="note-description" rows="3" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600"></textarea>\n            </div>\n            <div>\n                <label for="note-url" class="block text-sm font-medium text-gray-400">URL</label>\n                <input type="url" id="note-url" placeholder="https://example.com/document.pdf" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n            </div>\n        </div>\n    ');A("Add New Note",r,'<div class="flex justify-end"><button id="submit-note-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Create Note</button></div>',i=>{l.notesStudentFilter&&(i.querySelector("#note-student-id").value=l.notesStudentFilter),i.querySelector("#submit-note-btn").addEventListener("click",async()=>{const n={student_id:i.querySelector("#note-student-id").value,subject:i.querySelector("#note-subject").value,note_type:i.querySelector("#note-type").value,name:i.querySelector("#note-name").value.trim(),description:i.querySelector("#note-description").value.trim(),url:i.querySelector("#note-url").value.trim()};if(!n.student_id||!n.name){v("error","Student and Note Name are required.");return}$("Creating note...");try{await is(n),P(),v("success","Note created successfully."),await T()}catch(o){v("error","Failed to create note: ".concat(o.message))}})})}function Dt(e){const s=w.noteSubjects.map(i=>'<option value="'.concat(i,'" ').concat(e.subject===i?"selected":"",">").concat(i,"</option>")).join(""),t=w.noteTypes.map(i=>'<option value="'.concat(i,'" ').concat(e.note_type===i?"selected":"",">").concat(i.replace(/_/g," "),"</option>")).join(""),r='\n        <div class="space-y-4">\n             <p class="text-sm text-gray-400">Student: <span class="font-semibold">'.concat(e.student.first_name," ").concat(e.student.last_name,'</span></p>\n            <div class="grid grid-cols-2 gap-4">\n                <div>\n                    <label for="note-subject" class="block text-sm font-medium text-gray-400">Subject</label>\n                    <select id="note-subject" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(s,'</select>\n                </div>\n                <div>\n                    <label for="note-type" class="block text-sm font-medium text-gray-400">Note Type</label>\n                    <select id="note-type" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(t,'</select>\n                </div>\n            </div>\n            <div>\n                <label for="note-name" class="block text-sm font-medium text-gray-400">Note Name</label>\n                <input type="text" id="note-name" value="').concat(e.name,'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n            </div>\n            <div>\n                <label for="note-description" class="block text-sm font-medium text-gray-400">Description</label>\n                <textarea id="note-description" rows="3" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">').concat(e.description||"",'</textarea>\n            </div>\n            <div>\n                <label for="note-url" class="block text-sm font-medium text-gray-400">URL</label>\n                <input type="url" id="note-url" value="').concat(e.url||"",'" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n            </div>\n        </div>\n    ');A("Edit Note",r,'<div class="flex justify-end"><button id="submit-update-note-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Save Changes</button></div>',i=>{i.querySelector("#submit-update-note-btn").addEventListener("click",async()=>{const n={subject:i.querySelector("#note-subject").value,note_type:i.querySelector("#note-type").value,name:i.querySelector("#note-name").value.trim(),description:i.querySelector("#note-description").value.trim(),url:i.querySelector("#note-url").value.trim()};if(!n.name){v("error","Note Name is required.");return}$("Updating note...");try{await rs(e.id,n),P(),v("success","Note updated successfully."),await T()}catch(o){v("error","Failed to update note: ".concat(o.message))}})})}const we=document.getElementById("page-content"),M=document.getElementById("page-title");function F(e){l.currentPage=e,l.isSidebarOpen&&me(),T()}async function T(){we.innerHTML='<div class="flex justify-center items-center h-full"><div class="loader"></div></div>';try{let e="";switch(l.currentPage){case"login":M.textContent="Login / Sign Up",e=bt();break;case"timetable":M.textContent="Timetable",e=await at();break;case"logs":M.textContent="Logs",e=await yt();break;case"student-info":M.textContent="Student Info",e=ft();break;case"settings":M.textContent="Settings",e=vt();break;case"notes":M.textContent="Notes",e=await xe();break;case"tuitions":M.textContent="Tuitions",e=await xt();break;case"teacher-tuition-logs":M.textContent="Tuition Logs",e=await _t();break;case"teacher-payment-logs":M.textContent="Payment Logs",e=await ve();break;case"teacher-notes":M.textContent="Notes",e=await xe();break;case"teacher-timetables":M.textContent="Timetables",e=wt();break;case"teacher-student-info":M.textContent="Student Info",e=await It();break;case"teacher-payment-logs":M.textContent="Payment Logs",e=await ve();break;case"profile":M.textContent="Profile",e=await rt();break;default:M.textContent="Not Found",e="<p>Page not found.</p>"}we.innerHTML=e}catch(e){console.error("Failed to render page:",e),Te("Error loading page: ".concat(e.message))}}async function Ot(){try{const e=await ne();l.students=e,l.currentStudent=e[0]||null}catch(e){console.error("Error loading parent students:",e)}}async function Mt(){}async function se(){if(localStorage.getItem("accessToken"))try{const s=await Rt();l.currentUser=s,de(s.role),document.getElementById("user-info").classList.remove("hidden"),document.getElementById("logout-button").classList.remove("hidden"),document.getElementById("user-email").textContent=s.email,s.role==="parent"?(await Ot(),l.students.length===0?F("student-info"):F("timetable")):s.role==="student"?(await Mt(),F("timetable")):s.role==="teacher"&&F("teacher-tuition-logs")}catch(s){console.error("Failed to fetch user with token:",s),ge(),R("Your session may have expired. Please log in again.")}else de(null),l.currentUser=null,l.students=[],l.currentStudent=null,document.getElementById("user-info").classList.add("hidden"),document.getElementById("logout-button").classList.add("hidden"),F("login")}async function Ut(e,s){$("Logging in...");try{const t=await Ht(e,s);localStorage.setItem("accessToken",t.access_token),await se()}catch(t){R(t.message)}finally{k()}}async function qt(e,s,t,r,a,i=[]){$("Signing up...");try{await Ft(e,s,t,r,a,i),k(),R("Signup successful! Please log in with your new account.","success")}catch(n){k(),R(n.message)}}function ge(){localStorage.removeItem("accessToken"),l.currentUser=null,l.students=[],l.currentStudent=null,document.getElementById("user-info").classList.add("hidden"),document.getElementById("logout-button").classList.add("hidden"),de(null),F("login")}async function S(e,s={}){const t=localStorage.getItem("accessToken"),r={"Content-Type":"application/json",...s.headers};t&&(r.Authorization="Bearer ".concat(t));const a={...s,headers:r};try{const i=await fetch("".concat(w.backendUrl).concat(e),a);if(i.status===204)return null;const n=await i.json();if(!i.ok){if(i.status===401)return k(),ge(),new Promise(()=>{});let o="HTTP error! status: ".concat(i.status);throw n&&n.detail&&(Array.isArray(n.detail)?o=n.detail.map(u=>"".concat(u.loc.join(" -> "),": ").concat(u.msg)).join("; "):o=n.detail),new Error(o)}return n}catch(i){throw console.error("API Request Error:",i),i}}async function Ht(e,s){const t={username:e,password:s},r=Object.keys(t).map(n=>encodeURIComponent(n)+"="+encodeURIComponent(t[n])).join("&"),a=await fetch("".concat(w.backendUrl,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:r}),i=await a.json();if(!a.ok){if(a.status===400)throw new Error("Incorrect email or password.");const n=i.detail&&Array.isArray(i.detail)?i.detail.map(o=>o.msg).join(", "):i.detail||"HTTP error! status: ".concat(a.status);throw new Error(n)}return i}const Ft=(e,s,t,r,a,i=[])=>{const n=a==="parent"?"/auth/signup/parent":"/auth/signup/teacher",o={email:e,password:s,first_name:t,last_name:r};return a==="teacher"&&(o.teacher_specialties=i),S(n,{method:"POST",body:JSON.stringify(o)})},Rt=()=>S("/users/me"),zt=()=>fetch(w.backendUrl),ne=()=>S("/students/"),ae=e=>S("/students/".concat(e)),Ne=(e,s)=>{const t={...s,parent_id:e};return S("/students/",{method:"POST",body:JSON.stringify(t)})},Wt=e=>S("/students/".concat(e),{method:"DELETE"}),Ce=()=>S("/timetable/"),Ae=()=>S("/tuition-logs/"),Gt=()=>S("/payment-logs/"),Be=()=>S("/financial-summary/"),Vt=()=>S("/tuitions/"),Kt=()=>S("/tuitions/"),Jt=e=>S("/tuition-logs",{method:"POST",body:JSON.stringify(e)}),Yt=e=>S("/tuition-logs/".concat(e,"/void"),{method:"PATCH"}),Zt=(e,s)=>S("/tuition-logs/".concat(e,"/correction"),{method:"POST",body:JSON.stringify(s)}),Qt=()=>S("/parents/"),Xt=e=>S("/payment-logs",{method:"POST",body:JSON.stringify(e)}),es=e=>S("/payment-logs/".concat(e,"/void"),{method:"PATCH"}),ts=(e,s)=>S("/payment-logs/".concat(e,"/correction"),{method:"POST",body:JSON.stringify(s)}),De=(e,s,t)=>{const r={meeting_link_type:"GOOGLE_MEET",meeting_link:e,meeting_password:s||null,meeting_id:t||null};if(!r.meeting_id)try{const a=new URL(e);a.hostname==="meet.google.com"&&(r.meeting_id=a.pathname.substring(1))}catch(a){}return r},ss=(e,s,t,r)=>S("/tuitions/".concat(e,"/meeting_link"),{method:"POST",body:JSON.stringify(De(s,t,r))}),ns=(e,s,t,r)=>S("/tuitions/".concat(e,"/meeting_link"),{method:"PATCH",body:JSON.stringify(De(s,t,r))}),Oe=e=>S("/tuitions/".concat(e,"/meeting_link"),{method:"DELETE"}),as=()=>S("/notes/"),is=e=>S("/notes/",{method:"POST",body:JSON.stringify(e)}),rs=(e,s)=>S("/notes/".concat(e),{method:"PATCH",body:JSON.stringify(s)}),os=e=>S("/notes/".concat(e),{method:"DELETE"}),Me=e=>S("/teachers/".concat(e)),ds=e=>S("/parents/".concat(e)),ls=(e,s)=>S("/teachers/".concat(e),{method:"PATCH",body:JSON.stringify(s)}),cs=(e,s)=>S("/parents/".concat(e),{method:"PATCH",body:JSON.stringify(s)}),ie=(e,s)=>S("/students/".concat(e),{method:"PATCH",body:JSON.stringify(s)}),Ue=async()=>Promise.resolve(["UTC","Asia/Kuwait","Asia/Riyadh","Asia/Dubai","Europe/London","America/New_York"]),qe=async()=>Promise.resolve(["KWD","USD","EUR","GBP","SAR","AED"]),us=(e,s)=>S("/teachers/".concat(e,"/specialties"),{method:"POST",body:JSON.stringify(s)}),ms=(e,s)=>S("/teachers/".concat(e,"/specialties/").concat(s),{method:"DELETE"}),He=e=>S("/teachers/".concat(e,"/specialties")),gs=(e,s,t)=>{const r={subject:e,educational_system:s};t&&(r.grade=t);const a=new URLSearchParams(r).toString();return S("/teachers/by_specialty?".concat(a))};function bs(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function ps(e){return'\n        <div class="space-y-4">\n            <input type="text" id="firstName" placeholder="First Name" value="'.concat(e.firstName||"",'" required class="w-full p-3 bg-gray-700 rounded-md border border-gray-600">\n            <input type="text" id="lastName" placeholder="Last Name" value="').concat(e.lastName||"",'" required class="w-full p-3 bg-gray-700 rounded-md border border-gray-600">\n            <input type="text" id="grade" placeholder="Grade (e.g., 10)" value="').concat(e.grade||"",'" required class="w-full p-3 bg-gray-700 rounded-md border border-gray-600">\n        </div>')}function fs(e){const s=w.subjects.map(a=>'<option value="'.concat(a,'">').concat(a,"</option>")).join(""),t=l.students.filter(a=>a.id!==e.id),r=e.subjects.map((a,i)=>{const n=a.sharedWith.map(u=>{const b=l.students.find(g=>g.id===u);return b?b.firstName:""}).filter(Boolean).join(", "),o=t.length>0?t.map(u=>'\n            <label class="flex items-center space-x-2 p-1 hover:bg-gray-600 rounded-md">\n                <input type="checkbox" class="share-checkbox" data-subject-index="'.concat(i,'" data-student-id="').concat(u.id,'" ').concat(a.sharedWith.includes(u.id)?"checked":"",">\n                <span>").concat(u.firstName," ").concat(u.lastName,"</span>\n            </label>")).join(""):'<div class="px-2 py-1 text-sm text-gray-400">No other students to share with.</div>';return'\n            <div class="bg-gray-700 p-2 rounded-md">\n                <div class="flex justify-between items-center">\n                    <div>\n                        <p>'.concat(a.name," - ").concat(a.lessonsPerWeek," lessons/week</p>\n                        ").concat(n?'<p class="text-xs text-indigo-300">Shared with: '.concat(n,"</p>"):"",'\n                    </div>\n                    <div class="flex items-center space-x-2">\n                        <div class="relative share-container">\n                            <button class="share-btn p-2 text-sm bg-indigo-600 hover:bg-indigo-700 rounded-md"><i class="fas fa-users mr-1"></i> Allowed Others</button>\n                            <div class="share-dropdown hidden absolute right-0 mt-1 w-48">').concat(o,'</div>\n                        </div>\n                        <button class="remove-subject-btn text-red-400 hover:text-red-300" data-index="').concat(i,'"><i class="fas fa-times-circle"></i></button>\n                    </div>\n                </div>\n            </div>')}).join("");return'\n        <div id="registered-subjects-list" class="space-y-2 mb-4">'.concat(r||'<p class="text-sm text-gray-400">No subjects added yet.</p>','</div>\n        <div class="flex space-x-2">\n            <select id="subject-select" class="flex-grow p-2 bg-gray-700 rounded-md border border-gray-600">').concat(s,'</select>\n            <input type="number" id="lessons-per-week" placeholder="Lessons/wk" min="1" value="1" class="w-28 p-2 bg-gray-700 rounded-md border border-gray-600">\n            <button id="add-subject-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold p-2 rounded-md"><i class="fas fa-plus"></i> Add</button>\n        </div>')}function ys(e){return'<div id="wizard-timetable-container">'.concat(Z(!0,e),"</div>")}function vs(){return'\n        <div class="text-center py-8">\n            <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>\n            <h3 class="text-2xl font-semibold">All Set!</h3>\n            <p class="text-gray-400 mt-2">All student information has been entered. Click Finish to save.</p>\n        </div>'}function hs(e,s,t){if(e===1){const r=t.querySelector("#firstName").value.trim(),a=t.querySelector("#lastName").value.trim(),i=t.querySelector("#grade").value.trim();if(!r||!a||!i)return Qe("Validation Error","<p>Please fill in all fields.</p>"),!1;s.firstName=r,s.lastName=a,s.grade=i}return!0}function Se(e=null,s){let t=1,r=e?JSON.parse(JSON.stringify(e)):{id:bs(),subjects:[],availability:{}};if(!e){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday"];w.daysOfWeek.forEach(o=>{const u=o.toLowerCase();r.availability[u]=[],r.availability[u].push({type:"sleep",...w.defaultSleepTimes}),n.includes(o)&&r.availability[u].push({type:"school",...w.defaultSchoolTimes})})}const a=()=>{let n="",o="";switch(t){case 1:n=ps(r),o='<div class="flex justify-end"><button id="wizard-next-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Next</button></div>';break;case 2:n=fs(r),o='<div class="flex justify-between"><button id="wizard-prev-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Back</button><button id="wizard-next-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Next</button></div>';break;case 3:n=ys(r),o='<div class="flex justify-between"><button id="wizard-prev-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Back</button><button id="wizard-next-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Next</button></div>';break;case 4:n=vs(),o='<div class="flex justify-between"><button id="wizard-prev-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-md">Back</button><button id="wizard-finish-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-md">Finish</button></div>';break}A("Student Registration - Step ".concat(t," of 4"),n,o,u=>i(u,r))},i=(n,o)=>{n.addEventListener("click",async u=>{const b=u.target,g=d=>b.closest(d);if(g("#wizard-next-btn")?hs(t,o,n)&&(t++,a()):g("#wizard-prev-btn")?(t--,a()):g("#wizard-finish-btn")&&await s(o),t===2){if(g("#add-subject-btn")){const m=n.querySelector("#subject-select").value,p=parseInt(n.querySelector("#lessons-per-week").value);p>0&&!o.subjects.find(y=>y.name===m)&&(o.subjects.push({name:m,lessonsPerWeek:p,sharedWith:[]}),a())}const d=g(".remove-subject-btn");d&&(o.subjects.splice(parseInt(d.dataset.index),1),a());const c=g(".share-btn");if(c){const m=c.nextElementSibling,p=m.classList.contains("hidden");document.querySelectorAll(".share-dropdown").forEach(y=>y.classList.add("hidden")),p&&m.classList.remove("hidden")}}if(t===3){const d=g(".day-nav-btn");d&&(l.currentTimetableDay=(l.currentTimetableDay+parseInt(d.dataset.direction)+7)%7,a());const c=()=>{const x=n.querySelector("#wizard-timetable-container");x&&(x.innerHTML=Z(!0,o))},m=g("#timetable-grid-main");m&&u.target===m&&K.showAddEventModal(o,m.dataset.dayKey,u.offsetY,c);const p=g(".event-bubble");p&&p.dataset.type!=="tuition"&&K.showEditEventModal(o,m.dataset.dayKey,p.dataset.start,c);const y=g(".set-all-times-btn");if(y){const x=y.dataset.type;K.showSetAllTimesModal(o,x,c)}}}),n.addEventListener("change",u=>{const b=u.target,d=(c=>b.closest(c))(".share-checkbox");if(d){const c=parseInt(d.dataset.subjectIndex),m=d.dataset.studentId,p=o.subjects[c].sharedWith;if(d.checked)p.includes(m)||p.push(m);else{const y=p.indexOf(m);y>-1&&p.splice(y,1)}a()}})};a()}const xs="modulepreload",ws=function(e){return"/"+e},$e={},Ss=function(s,t,r){let a=Promise.resolve();if(t&&t.length>0){let u=function(b){return Promise.all(b.map(g=>Promise.resolve(g).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));a=u(t.map(b=>{if(b=ws(b),b in $e)return;$e[b]=!0;const g=b.endsWith(".css"),d=g?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(b,'"]').concat(d)))return;const c=document.createElement("link");if(c.rel=g?"stylesheet":xs,g||(c.as="script"),c.crossOrigin="",c.href=b,o&&c.setAttribute("nonce",o),document.head.appendChild(c),g)return new Promise((m,p)=>{c.addEventListener("load",m),c.addEventListener("error",()=>p(new Error("Unable to preload CSS for ".concat(b))))})}))}function i(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return a.then(n=>{for(const o of n||[])o.status==="rejected"&&i(o.reason);return s().catch(i)})},_e=te("App",{web:()=>Ss(()=>import("./web-B5dhIVB0.js"),[]).then(e=>new e.AppWeb)}),Q=te("PushNotifications",{});let W=[];async function ke(e){if(l.currentUser){$("Saving student data...");try{await Ne(l.currentUser.id,e),await se(),P(),v("success","Student saved successfully!"),F("student-info")}catch(s){console.error("Error saving student:",s),v("error",s.message)}}}async function $s(e){if(l.currentUser){$("Deleting student...");try{await Wt(e),await se(),v("success","Student deleted."),T()}catch(s){console.error("Error deleting student:",s),v("error",s.message)}}}async function _s(e){$("Fetching credentials...");try{const s=await ae(e),t='\n            <div class="space-y-4">\n                <div>\n                    <label class="text-sm font-medium text-gray-400">Email</label>\n                    <input type="text" readonly value="'.concat(s.email,'" class="w-full mt-1 p-2 bg-gray-800 rounded-md border border-gray-600">\n                </div>\n                <div>\n                    <label class="text-sm font-medium text-gray-400">Password</label>\n                    <input type="text" readonly value="').concat(s.generated_password,'" class="w-full mt-1 p-2 bg-gray-800 rounded-md border border-gray-600">\n                </div>\n                <p class="text-xs text-gray-500">Please save this password in a secure location.</p>\n            </div>\n        ');A("Student Credentials",t,'<div class="flex justify-end"><button id="modal-close-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Close</button></div>')}catch(s){v("error",s.message)}finally{k()}}async function ks(e){const s=document.getElementById("profile-first-name").value.trim(),t=document.getElementById("profile-last-name").value.trim(),r=document.getElementById("profile-email").value.trim(),a=document.getElementById("profile-timezone").value,i=document.getElementById("profile-currency").value;if(!s||!t||!r){v("error","Name and Email are required.");return}const n={first_name:s,last_name:t,email:r,timezone:a||null,currency:i||null};$("Updating Profile...");try{await ls(e,n),l.currentUser&&l.currentUser.id===e&&(l.currentUser.first_name=s,l.currentUser.last_name=t,l.currentUser.email=r),v("success","Profile updated successfully."),T()}catch(o){console.error("Profile update error:",o),v("error",o.message)}}async function Ls(e){const s=document.getElementById("profile-first-name").value.trim(),t=document.getElementById("profile-last-name").value.trim(),r=document.getElementById("profile-email").value.trim(),a=document.getElementById("profile-timezone").value,i=document.getElementById("profile-currency").value;if(!s||!t||!r){v("error","Name and Email are required.");return}const n={first_name:s,last_name:t,email:r,timezone:a||null,currency:i||null};$("Updating Profile...");try{await cs(e,n),l.currentUser&&l.currentUser.id===e&&(l.currentUser.first_name=s,l.currentUser.last_name=t,l.currentUser.email=r),v("success","Profile updated successfully."),T()}catch(o){console.error("Parent profile update error:",o),v("error",o.message)}}function Es(e){const s=w.noteSubjects.map(i=>'<option value="'.concat(i,'">').concat(i,"</option>")).join(""),t=w.educationalSystems.map(i=>'<option value="'.concat(i,'">').concat(i,"</option>")).join(""),r='\n        <div class="space-y-4">\n            <div class="grid grid-cols-2 gap-4">\n                <div>\n                    <label class="text-sm text-gray-400">Subject</label>\n                    <select id="new-specialty-subject" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                        '.concat(s,'\n                    </select>\n                </div>\n                <div>\n                    <label class="text-sm text-gray-400">System</label>\n                    <select id="new-specialty-system" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600">\n                        ').concat(t,'\n                    </select>\n                </div>\n            </div>\n            <div>\n                <label class="text-sm text-gray-400">Grade</label>\n                <input type="number" id="new-specialty-grade" min="1" max="12" class="w-full mt-1 p-2 bg-gray-700 rounded-md border border-gray-600" placeholder="1-12">\n            </div>\n        </div>\n    ');A("Add Specialty",r,'<div class="flex justify-end"><button id="submit-new-specialty-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-md">Add Specialty</button></div>',i=>{i.querySelector("#submit-new-specialty-btn").addEventListener("click",async()=>{const n=i.querySelector("#new-specialty-subject").value,o=i.querySelector("#new-specialty-system").value,u=parseInt(i.querySelector("#new-specialty-grade").value);if(!n||!o||isNaN(u)||u<1||u>12){alert("Please enter valid subject, system, and grade (1-12).");return}$("Adding specialty...");try{await us(e,{subject:n,educational_system:o,grade:u}),P(),v("success","Specialty added."),T()}catch(b){v("error",b.message)}})})}function Le(e=!1){je();const s=document.getElementById("email").value.trim(),t=document.getElementById("password").value,r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;let a=null,i=null,n=null;return e&&(a=document.getElementById("firstName").value.trim(),i=document.getElementById("lastName").value.trim(),n=document.getElementById("role").value,!a||!i)?(R("First name and last name cannot be empty for signup."),null):!s||!t?(R("Email and password cannot be empty."),null):r.test(s)?t.length<6?(R("Password must be at least 6 characters long."),null):{email:s,password:t,firstName:a,lastName:i,role:n}:(R("Please enter a valid email address."),null)}function js(e){je();const s=document.getElementById("auth-title"),t=document.getElementById("first-name-group"),r=document.getElementById("last-name-group"),a=document.getElementById("role-group"),i=document.getElementById("auth-action-btn"),n=document.getElementById("auth-toggle-btn");document.getElementById("step-1-container").classList.remove("hidden"),document.getElementById("step-2-container").classList.add("hidden"),document.getElementById("auth-back-btn").classList.add("hidden"),W=[],le(),e?(s.textContent="Create Account - Sign Up",t.classList.remove("hidden"),r.classList.remove("hidden"),a.classList.remove("hidden"),i.textContent="Sign Up",n.textContent="Already have an account? Log In",i.dataset.mode="signup",ee()):(s.textContent="Welcome - Log In",t.classList.add("hidden"),r.classList.add("hidden"),a.classList.add("hidden"),i.textContent="Login",n.textContent="Need an account? Sign Up",i.dataset.mode="login")}function ee(){const e=document.getElementById("role").value,s=document.getElementById("auth-action-btn"),t=s.dataset.mode==="signup",r=!document.getElementById("step-2-container").classList.contains("hidden");t&&e==="teacher"&&!r?s.textContent="Next":t&&(s.textContent="Sign Up")}function Ts(){const e=document.getElementById("specialty-subject"),s=document.getElementById("specialty-system");e.options.length===0&&(e.innerHTML=w.noteSubjects.map(t=>'<option value="'.concat(t,'">').concat(t,"</option>")).join("")),s.options.length===0&&(s.innerHTML=w.educationalSystems.map(t=>'<option value="'.concat(t,'">').concat(t,"</option>")).join(""))}function le(){const e=document.getElementById("specialties-list");if(W.length===0){e.innerHTML='<p class="text-center text-gray-500 text-sm py-2">No specialties added yet.</p>';return}const s=W.map((t,r)=>'\n        <div class="flex justify-between items-center bg-gray-800 p-2 rounded text-sm border border-gray-600">\n            <span><span class="font-bold text-indigo-400">'.concat(t.subject,'</span> <span class="text-xs text-gray-400">(').concat(t.educational_system,")</span> Grade ").concat(t.grade,'</span>\n            <button type="button" class="remove-specialty-btn text-red-400 hover:text-red-300" data-index="').concat(r,'"><i class="fas fa-times"></i></button>\n        </div>\n    ')).join("");e.innerHTML=s}document.body.addEventListener("click",e=>{var B,I;const s=e.target,t=f=>s.closest(f);t(".share-container")||document.querySelectorAll(".share-dropdown").forEach(f=>f.classList.add("hidden")),t("#menu-button")&&me(),(t("#modal-close-btn")||t("#modal-backdrop")&&!t(".modal-content"))&&P(),t("#theme-toggle-btn")&&(document.documentElement.classList.toggle("dark"),document.documentElement.classList.toggle("light"),T());const r=t(".nav-link");if(r&&(e.preventDefault(),F(r.id.replace("nav-",""))),t("#auth-action-btn")){e.preventDefault();const f=s.dataset.mode||"login",h=document.getElementById("role").value,_=document.getElementById("step-1-container"),C=document.getElementById("step-2-container"),D=document.getElementById("auth-back-btn");if(document.getElementById("auth-action-btn"),f==="signup"&&h==="teacher"&&C.classList.contains("hidden"))Le(!0)&&(_.classList.add("hidden"),C.classList.remove("hidden"),D.classList.remove("hidden"),Ts(),ee());else{const O=Le(f==="signup");if(O)if(f==="signup"){if(h==="teacher"&&(O.teacher_specialties=W,W.length===0)){R("Please add at least one specialty.","error");return}qt(O.email,O.password,O.firstName,O.lastName,O.role,O.teacher_specialties)}else Ut(O.email,O.password)}}if(t("#auth-back-btn")&&(document.getElementById("step-1-container").classList.remove("hidden"),document.getElementById("step-2-container").classList.add("hidden"),document.getElementById("auth-back-btn").classList.add("hidden"),ee()),t("#add-specialty-btn")){const f=document.getElementById("specialty-subject").value,h=document.getElementById("specialty-system").value,_=parseInt(document.getElementById("specialty-grade-from").value),C=parseInt(document.getElementById("specialty-grade-to").value);if(!f||!h||isNaN(_)||isNaN(C))return;if(_<1||C>12||_>C){alert("Invalid grade range (1-12).");return}for(let D=_;D<=C;D++)W.some(z=>z.subject===f&&z.educational_system===h&&z.grade===D)||W.push({subject:f,educational_system:h,grade:D});le(),document.getElementById("specialty-grade-from").value="",document.getElementById("specialty-grade-to").value=""}const a=t(".remove-specialty-btn");if(a){const f=parseInt(a.dataset.index);W.splice(f,1),le()}if(t("#auth-toggle-btn")){e.preventDefault();const f=document.getElementById("auth-action-btn").dataset.mode||"login";js(f==="login")}t("#logout-button")&&ge(),t("#add-new-student-btn")&&Se(null,ke);const i=t(".edit-student-btn");if(i){const f=l.students.find(h=>h.id===i.dataset.id);f&&Se(f,ke)}const n=t(".delete-student-btn");if(n){const f=l.students.find(h=>h.id===n.dataset.id);f&&pt(f,$s)}const o=t(".view-creds-btn");o&&_s(o.dataset.id),t("#add-new-log-btn")&&ye();const u=t(".void-log-btn");u&&kt(u.dataset.logId);const b=t(".correct-log-btn");if(b){const f=b.dataset.logId,h=(B=l.teacherTuitionLogs)==null?void 0:B.find(_=>_.id===f);h&&ye(h)}const g=t(".view-charges-btn");g&&Lt(g.dataset.logId),t("#add-new-payment-log-btn")&&he();const d=t(".void-payment-log-btn");d&&jt(d.dataset.logId);const c=t(".correct-payment-log-btn");if(c){const f=c.dataset.logId,h=(I=l.teacherPaymentLogs)==null?void 0:I.find(_=>_.id===f);h&&he(h)}const m=t(".view-meeting-link-btn");if(m){const f=m.dataset.tuitionId,h=(l.teacherScheduledTuitions||[]).find(_=>_.tuition.id===f);h&&h.tuition&&Pt(h.tuition)}const p=t(".edit-meeting-link-btn");if(p){const f=p.dataset.tuitionId,h=(l.teacherScheduledTuitions||[]).find(_=>_.tuition.id===f);h&&Tt(h.tuition)}const y=t(".delete-meeting-link-btn");if(y){const f=y.dataset.tuitionId;X("Delete Meeting Link","Are you sure you want to delete the meeting link for this tuition?",()=>{$("Deleting link..."),Oe(f).then(()=>{v("success","Meeting link deleted."),T()}).catch(h=>{v("error","Failed to delete link: ".concat(h.message))}).finally(()=>{P()})})}t("#add-new-note-btn")&&Bt();const x=t(".edit-note-btn");if(x){const f=l.notes.find(h=>h.id===x.dataset.noteId);f&&Dt(f)}const N=t(".delete-note-btn");if(N){const f=N.dataset.noteId,h=l.notes.find(C=>C.id===f),_=h?'"'.concat(h.name,'"'):"this note";X("Delete Note","Are you sure you want to delete ".concat(_,"?"),()=>{$("Deleting note..."),os(f).then(()=>{v("success","Note deleted."),T()}).catch(C=>v("error","Failed to delete note: ".concat(C.message)))})}const E=t(".subject-card-button");if(E){const f=E.dataset.subject;document.getElementById("notes-content-container").innerHTML=At(f)}t("#back-to-subjects-btn")&&T(),t("#save-teacher-profile-btn")&&ks(t("#save-teacher-profile-btn").dataset.userId),t("#save-parent-profile-btn")&&Ls(t("#save-parent-profile-btn").dataset.userId),t("#open-add-specialty-modal-btn")&&Es(t("#open-add-specialty-modal-btn").dataset.userId);const U=t(".delete-specialty-btn");if(U){const f=U.dataset.id,h=U.dataset.teacherId;X("Delete Specialty","Are you sure you want to remove this specialty?",async()=>{$("Deleting specialty...");try{await ms(h,f),v("success","Specialty removed."),T()}catch(_){v("error",_.message)}})}t("#btn-create-student")&&V(null,"create").then(f=>{document.getElementById("page-content").innerHTML=f});const q=t(".btn-view-student");if(q){const f=q.dataset.id;V(f,"edit").then(h=>{document.getElementById("page-content").innerHTML=h})}if(t("#save-student-details-btn")){const f=t("#save-student-details-btn");lt(f.dataset.studentId)}if(t("#save-student-availability-btn")){const f=t("#save-student-availability-btn");ct(f.dataset.studentId)}t("#create-student-btn")&&ut(),t("#add-student-subject-btn")&&mt(t("#add-student-subject-btn").dataset.studentId);const j=t(".remove-subject-btn");if(j&&gt(j.dataset.studentId,parseInt(j.dataset.subjectIndex)),t("#cancel-create-student-btn")&&T(),t("#profile-timetable-wrapper")){const f=t("#timetable-grid-main");f&&s===f&&oe("add",f.dataset.dayKey,e.offsetY);const h=t(".event-bubble");h&&f&&oe("edit",f.dataset.dayKey,h.dataset.start);const _=t(".set-all-times-btn");_&&oe("setAll",_.dataset.type)}if(t("#page-content .timetable-component")){const f=t(".day-nav-btn");if(f){const h=parseInt(f.dataset.direction);l.currentTimetableDay=(l.currentTimetableDay+h+7)%7,t("#profile-timetable-wrapper")?Ie():T()}}});document.getElementById("page-content").addEventListener("change",e=>{if(e.target.id==="student-selector"&&(l.currentStudent=l.students.find(s=>s.id===e.target.value)||null,T()),e.target.id==="notes-student-selector"&&(l.notesStudentFilter=e.target.value,T()),e.target.id==="role"&&ee(),e.target.id==="teacher-student-selector"){const s=e.target.value,t=document.getElementById("teacher-student-profile-container");s?V(s,"edit").then(r=>{t.innerHTML=r}):t.innerHTML='<div class="text-center text-gray-500 py-8">Select a student above to view and edit their details.</div>'}});_e.addListener("backButton",({canGoBack:e})=>{document.getElementById("modal-backdrop")?P():l.isSidebarOpen&&window.innerWidth<768?me():_e.exitApp()});async function Fe(){var e;F("login"),Xe(),$("Connecting to server...");try{if(await zt(),console.log("Backend connection successful."),k(),await se(),Y.isNativePlatform())try{(await Q.requestPermissions()).receive==="granted"&&await Q.register(),Q.addListener("registration",t=>{console.log("Push Registration Token:",t.value)}),Q.addListener("pushNotificationReceived",t=>{v("info",t.title||"New Notification")})}catch(s){console.warn("Push notification setup failed:",s)}}catch(s){console.error("Initialization Error:",s),k(),Te(s.message),(e=document.getElementById("retry-connection-btn"))==null||e.addEventListener("click",Fe)}}Fe();export{Ee as W,Ps as __vite_legacy_guard};
